<?phprequire_once dirname ( __FILE__ ) . '/view/errors.inc.php';require_once dirname ( __FILE__ ) . '/services/AppServiceImpl.class.php';if(!isset($_SESSION)) session_start(); // Start session// Already connected as Admin or Provider ?if( ( isset($_SESSION['adminConnected']) && !empty($_SESSION['adminConnected']) ) ||     ( isset($_SESSION['isStoreOrProvider']) && !empty($_SESSION['isStoreOrProvider']) && $_SESSION['isStoreOrProvider'] != 'store' )  ) {    header('Location: ./disconnection.php'); // User disconnected}header( 'content-type: text/html; charset=utf-8' ); // Specifies to the server to return UTF-8 - put in prod$appService = AppServiceImpl::getInstance();/*if( isset($_SESSION['arrayIndisposProviderForOneDay']) && !empty($_SESSION['arrayIndisposProviderForOneDay']) ) {        $arrayIndisposFournisseursPourUnJour = $_SESSION['arrayIndisposProviderForOneDay'];    print_r($arrayIndisposFournisseursPourUnJour);}*/if( isset($_POST) && !empty($_POST) ) {    // Recovery of data sent by the create form    for($z = 1 ; $z <= 5 ; $z++) {        $postDateTime   = $_POST['period_datetime_'.$z];         $postDate       = $_POST['period_date_'.$z];         $postSimpleDate = $_POST['simple_date_'.$z];         if( isset($postDateTime) && !empty($postDateTime) ) { // Period Datetime values                     $dataDatetime      = $appService->convertDateRangeToMySqlFormat($postDateTime);            $idUnavailability  = $appService->saveUnavailability($appService->createUnavailability($dataDatetime['startDatetime'], $dataDatetime['endDatetime'], $_SESSION['enterpriseConcerned'], $_SESSION['purchasingFairConcerned']));        }        if( isset($postDate) && !empty($postDate) ) { // Periode Date values            $dataDatetime      = $appService->convertDateRangeToMySqlFormat($postDate);            $idUnavailability  = $appService->saveUnavailability($appService->createUnavailability($dataDatetime['startDatetime'], $dataDatetime['endDatetime'], $_SESSION['enterpriseConcerned'], $_SESSION['purchasingFairConcerned']));        }        if( isset($postSimpleDate) && !empty($postSimpleDate) ) { // Simple Date values                 $dataDatetime      = $appService->convertDateRangeToMySqlFormat($postSimpleDate);            $idUnavailability  = $appService->saveUnavailability($appService->createUnavailability($dataDatetime['startDatetime'], $dataDatetime['endDatetime'], $_SESSION['enterpriseConcerned'], $_SESSION['purchasingFairConcerned']));        }    }        header('Location: ./store_unavailabilities_register.php'); // Home page redirection}//print_r($_SESSION['purchasingFairConcerned']);//print_r($_SESSION['purchasingFairConcerned']->getYearFromStartDatetime());/*on résupère une array de l'ensemble des date du début à la fin du salon*/$YearFromStartDatetime = $_SESSION['purchasingFairConcerned']->getYearFromStartDatetime();$MonthFromStartDatetime = $_SESSION['purchasingFairConcerned']->getMonthFromStartDatetime();$DayFromStartDatetime = $_SESSION['purchasingFairConcerned']->getDayFromStartDatetime();$YearFromEndDatetime = $_SESSION['purchasingFairConcerned']->getYearFromEndDatetime();$MonthFromEndDatetime = $_SESSION['purchasingFairConcerned']->getMonthFromEndDatetime();$DayFromEndDatetime = $_SESSION['purchasingFairConcerned']->getDayFromEndDatetime();$arrayDate = $appService->getDatesFromRange($YearFromStartDatetime.'-'.$MonthFromStartDatetime.'-'.$DayFromStartDatetime,$YearFromEndDatetime.'-'.$MonthFromEndDatetime.'-'.$DayFromEndDatetime);$arrayDateBis = array();foreach($arrayDate as $key => $value) {    $dd = $appService->nom_jour($value);    if($dd != "Samedi" && $dd != "Dimanche"){        $arrayDateBis[] = $value;    }}/*print_r($arrayDate);print_r($arrayDateBis);*/$HourStartDateTime = $_SESSION['purchasingFairConcerned']->getStartDateTime(); //2019-05-11 08:00:00//print_r($HourStartDateTime);$HourStartDateTimeBis = substr($HourStartDateTime, 11); //08:00:00//print_r($HourStartDateTimeBis);$HourStartDateTimeTer = substr($HourStartDateTimeBis,0,2).substr($HourStartDateTimeBis,3,2).substr($HourStartDateTimeBis,6,2);//080000//print_r($HourStartDateTimeTer);$HoursEndDateTime = $_SESSION['purchasingFairConcerned']->getEndDateTime();$HoursEndDateTimeBis = substr($HoursEndDateTime, 11);$HoursEndDateTimeTer = substr($HoursEndDateTimeBis,0,2).substr($HoursEndDateTimeBis,3,2).substr($HoursEndDateTimeBis,6,2);$PauseMidi = $_SESSION['purchasingFairConcerned']->getLunchBreak();//print_r($appService->nom_mois($arrayDate[1]));/*---------------------------------------------------------*/$arrayUnavailabilitiesAlreadyRegistered = $appService->findEnterpriseUnavailabilities($_SESSION['enterpriseConcerned'],$_SESSION['purchasingFairConcerned']);?><!DOCTYPE html><html lang="fr"><head>    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="theme-color" content="#0b70b5"><!-- Mobile browser Tab Color -->    <title>PFManagement | Prise de Rendez-vous</title>        <!-- Favicon -->    <?php require_once dirname ( __FILE__ ) . '/view/favicon.inc.php'; ?>    <!-- Bootstrap -->    <link href="css/bootstrap.min.css" rel="stylesheet">        <!-- Font Awesome -->    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">        <!-- Select2 -->    <link href="css/plugins/select2/select2.min.css" rel="stylesheet">        <!-- Hover -->    <link href="css/plugins/hover.css/hover-min.css" rel="stylesheet">        <!-- Daterangepicker -->    <link href="css/plugins/daterangepicker/daterangepicker.css" rel="stylesheet">        <!-- Toastr style -->    <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">    <!-- Animate -->    <link href="css/animate.css" rel="stylesheet">        <!-- Global -->    <link href="css/style.css" rel="stylesheet">        <!-- Custom style -->    <style>    /* Widget */    .widget { color:#ffffff;border:1px solid #ffffff; }    /* previous and next buttons */    #previousButton { background-color:#ffffff;color:#0b70b5;border:1px solid #0b70b5; }    #nextButton { background-color:#0b70b5;color:#ffffff;border:1px solid #000000; }    #submitButton { background-color:#0b70b5;color:#ffffff; }    .mydaterangepicker { cursor: pointer; }    #submitUnavailabilities { border:1px solid #000000; }    /* Update - Delete icons */    .fa { cursor:pointer; }    </style></head><body>    <!-- Modal -->    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">      <div class="modal-dialog modal-dialog-centered" role="document">        <div class="modal-content">          <div class="modal-header">            <h5 class="modal-title" id="exampleModalLongTitle">Prise de rendez-vous</h5>            <button type="button" class="close" data-dismiss="modal" aria-label="Close">              <span aria-hidden="true">&times;</span>            </button>          </div>          <div class="modal-body">            <div>                <span class="">Rendez-vous à : </span>                <span id="heurerdv"></span>            </div>            <div>                <span class="">Durée : </span>                <input id="dureerdv" type="time" name="appt" min="01:00" max="23:00" value="01:00" step="1800" required>				<!-- <img src="img/plus.png" onclick="$('#dureerdv').val($('#dureerdv').val()+00:30);">-->            </div>            <hr id="hrRepas">            <div style="text-align: center; margin-bottom: 5px;" id="divRepasBis">                <span style="margin-right: 5px">Souhaitez-vous déjeuner sur place ?</span>                <label class="radio-inline">                    <input type="radio" value="N" name="btradio" id="btradioFalse" checked="checked"><span class="radioRed" checked>&nbsp;Non</span>                </label>                <label class="radio-inline">                    <input type="radio" value="Y" name="btradio" id="btradioTrue"><span class="radioGreen">&nbsp;Oui</span>                </label>            </div>            <div style="text-align: center; display: none;" id="DivNumberRepas">                <span style="margin-right: 5px">Nombre de Repas souhaité : </span>                <input size="3" min="0" max="100" value="0" type="number" name="numberRepas" id="numberRepas">            </div>          </div>          <div class="modal-footer">            <button id="deleterdv" type="button" class="btn btn-secondary" data-dismiss="modal">Supprimer</button>            <button id="saverdv" type="button" class="btn btn-primary">Enregistrer</button>          </div>        </div>      </div>    </div>    <!--Modal Update Repas-->    <div class="modal fade" id="ModalUpdateRepas" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">      <div class="modal-dialog modal-dialog-centered" role="document">        <div class="modal-content">          <div class="modal-header">            <h5 class="modal-title" id="exampleModalLongTitle">Modification Repas</h5>            <button type="button" class="close" data-dismiss="modal" aria-label="Close">              <span aria-hidden="true">&times;</span>            </button>          </div>          <div class="modal-body">            <span style="margin-right: 5px">Combien de Repas Souhaitez-vous réserver ?</span>            <input size="3" min="0" max="100" value="0" type="number" name="numberRepas" id="numberUpdateRepas">          </div>          <div class="modal-footer">            <button id="saveNbRepas" type="button" class="btn btn-primary">Enregistrer</button>          </div>        </div>      </div>    </div>        <div id="wrapper">        <?php require_once dirname ( __FILE__ ) . '/view/menu.store.inc.php'; ?>        <div id="page-wrapper" class="gray-bg">        <div class="row border-bottom">        <nav class="navbar navbar-static-top  " role="navigation" style="margin-bottom: 0">        <div class="navbar-header">            <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>        </div>            <ul class="nav navbar-top-links navbar-right">                <li>                    <span class="m-r-sm text-muted welcome-message">Prise de Rendez-vous.</span>                </li>                <li>                    <a href="./disconnection.php">                        <i class="fa fa-sign-out"></i> Quitter                    </a>                </li>            </ul>        </nav>        </div>            <div class="row wrapper border-bottom white-bg page-heading">                <div class="col-lg-9">                    <h2><i class="fa fa-calendar-times-o" aria-hidden="true"></i> Prise de Rendez-vous</h2>                    <ol class="breadcrumb">                        <li>                            <a href="./purchasing_fair_list.php">Liste des RDV</a>                        </li>                                              <li class="active">                            <strong>Saisie Prise de Rendez-vous</strong>                        </li>                    </ol>                </div>                <div class="col-lg-3">                    <?php require_once dirname ( __FILE__ ) . '/view/widget_pf_info.inc.php'; ?>                </div>                            </div>            <div class="wrapper wrapper-content">                                                <div class="row" >                    <div id="warning-repas">                                            </div>                    <div style="text-align: center; margin-bottom: 20px;" id="td-1">                    <?php                    $arrayEnterprises = $appService->findAllEnterprisesAsProviders();                    foreach($arrayDateBis as $key => $value) {                        echo '<button id="btsdate" value="'.'date'.$value.'" type="submit" class="btn btn-primary btsdate" style="margin : 5px">'.$appService->nom_jour($value).' '.substr($value,8,2).' '.$appService->nom_mois($value).'</button>';                    }                    ?>                        </div>                    <div id="block-warning">                                            </div>                    <div class="col-md-12" id="planning-main">                                              <h3 class="text-center" value="" class="selectJour" id="dayclick">                            <!--<i class="fa fa-calendar" aria-hidden="true"></i>-->                                                    </h3>                        <div class="table-responsive" name="'.'date'.$value.'" id="tab_resp_'.$key.'">                            <table id="tableRDV" class="table table-striped table-bordered table-hover">                                <thead>                                    <tr>                                        <th style="vertical-align:middle;text-align:center;">COMMISSION</th>                                        <th style="vertical-align:middle;text-align:center;">PARTICIPANT</th>    <?php    for ($i=substr($HourStartDateTimeTer, 0, 2); $i < substr($HoursEndDateTimeTer, 0, 2); $i++) {        if($i == substr($PauseMidi, 0, 2)){            if(substr($PauseMidi, 3, 2) == "30"){                echo '<th id="'.$i.':00:00 - '.$i.':30:00'.'" name="thLunch">'.$i.'H00 - '.$i.'H30'.'</th>';                echo '<th id="'.$i.':30:00 - '.($i+1).':30:00'.'" name="thLunch">'.$i.'H30 - '.($i+1).'H30'.'</th>';            }else{                echo '<th id="'.$i.':00:00 - '.($i+1).':00:00'.'" name="thLunch">'.$i.'H00 - '.($i+1).'H00'.'</th>';            }        }else{            if($i == substr($HourStartDateTimeTer, 0, 2)){                if(substr($HourStartDateTimeTer, 2, 2) == "30"){                    if($i+1<=9){                        echo '<th id="'.substr($HourStartDateTimeTer,0,2).':30:00 - 0'.(substr($HourStartDateTimeTer,0,2)+1).':00:00'.'">'.substr($HourStartDateTimeTer,0,2).'H30 - 0'.(substr($HourStartDateTimeTer,0,2)+1).'H00'.'</th>';                    }else{                        echo '<th id="'.substr($HourStartDateTimeTer,0,2).':30:00 - '.(substr($HourStartDateTimeTer,0,2)+1).':00:00'.'">'.substr($HourStartDateTimeTer,0,2).'H30 - '.(substr($HourStartDateTimeTer,0,2)+1).'H00'.'</th>';                    }                }else{                    echo '<th id="'.substr($HourStartDateTimeTer,0,2).':00:00 - '.substr($HourStartDateTimeTer,0,2).':30:00'.'">'.substr($HourStartDateTimeTer,0,2).'H00 - '.substr($HourStartDateTimeTer,0,2).'H30'.'</th>';                    if($i+1<=9){                        echo '<th id="'.substr($HourStartDateTimeTer,0,2).':30:00 - 0'.(substr($HourStartDateTimeTer,0,2)+1).':00:00'.'">'.substr($HourStartDateTimeTer,0,2).'H30 - 0'.(substr($HourStartDateTimeTer,0,2)+1).'H00'.'</th>';                    }else{                        echo '<th id="'.substr($HourStartDateTimeTer,0,2).':30:00 - '.(substr($HourStartDateTimeTer,0,2)+1).':00:00'.'">'.substr($HourStartDateTimeTer,0,2).'H30 - '.(substr($HourStartDateTimeTer,0,2)+1).'H00'.'</th>';                    }                }            }else{                if($i != substr($HoursEndDateTimeTer, 0, 2)){                    if(substr($PauseMidi, 3, 2) == "30" && $i == (substr($PauseMidi, 0, 2)+1)){                        echo '<th id="'.$i.':30:00 - '.($i+1).':00:00'.'">'.$i.'H30 - '.($i+1).'H00'.'</th>';                    }else{                        if($i<=9){                            echo '<th id="0'.$i.':00:00 - 0'.$i.':30:00'.'">0'.$i.'H00 - 0'.$i.'H30'.'</th>';                            if($i+1<=9){                                echo '<th id="0'.$i.':30:00 - 0'.($i+1).':00:00'.'">0'.$i.'H30 - 0'.($i+1).'H00'.'</th>';                            }else{                                echo '<th id="0'.$i.':30:00 - '.($i+1).':00:00'.'">0'.$i.'H30 - '.($i+1).'H00'.'</th>';                            }                        }else{                            echo '<th id="'.$i.':00:00 - '.$i.':30:00'.'">'.$i.'H00 - '.$i.'H30'.'</th>';                            echo '<th id="'.$i.':30:00 - '.($i+1).':00:00'.'">'.$i.'H30 - '.($i+1).'H00'.'</th>';                        }                    }                                    }else{                    if(substr($HoursEndDateTimeTer, 2, 2) == "30"){                        echo '<th id="'.$i.':00:00 - '.$i.':30:00'.'">'.$i.'H00 - '.$i.'H30'.'</th>';                    }                }            }        }    }    ?>                                    </tr>                                </thead>                                <tbody>                                </tbody>                            </table>                        </div>                        <!--<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">                          Launch demo modal                        </button>-->                                        </div><!-- ./row -->                </div>            <div class="footer">                <div class="pull-right">                    <strong><i class="fa fa-copyright" aria-hidden="true"></i></strong> E.Leclerc | SCA Ouest <?php echo date('Y'); ?>                </div>                <div>                    <strong>PFManagement</strong>                </div>            </div>        </div>        </div>    <!-- Mainly scripts -->    <script src="js/jquery-3.1.1.min.js"></script>    <script src="js/bootstrap.min.js"></script>    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>        <!-- Toastr script -->    <script src="js/plugins/toastr/toastr.min.js"></script>        <!-- Bootbox -->    <script src="js/plugins/bootbox.js/bootbox.min.js"></script>    <!-- Custom and plugin javascript -->    <script src="js/inspinia.js"></script>    <script src="js/plugins/pace/pace.min.js"></script>        <!-- Select2 -->    <script src="js/plugins/select2/select2.full.min.js"></script>        <!-- Daterange picker -->    <script src="js/plugins/daterangepicker/moment.min.js"></script>    <script src="js/plugins/daterangepicker/daterangepicker.js"></script>    <script language="javascript" type='text/javascript'>        function session(){            window.location="disconnection.php"; //page de déconnexion        }        setTimeout("session()",900000); //ça fait bien 5min??? c'est pour le test    </script>    <script>        bootbox.setDefaults({ locale: "fr" });        $Repas = "0";        $('input[type=radio][name=btradio][value=N]').attr('checked', 'true');        $('#btradioTrue').change(function(){            $('#DivNumberRepas').css(["display","block"]);            $('#DivNumberRepas').show();            $Repas = "1";            //console.log("true");        });        $('#btradioFalse').change(function(){            $('#DivNumberRepas').css(["display","none"]);            $('#DivNumberRepas').hide();            $Repas = "0";            //console.log("false");        });        function deleteRepas($Jour) {                        bootbox.confirm("Confirmer la suppression ?", function(result) {                if(result === true) {                                        $.post(                        './ajax/deleteRepas.php',                        {                            JourSelect : $Jour,                        },                        function(data) {                            //console.log(data);                            $donnees = data.trim().substring(0,5);                            if($donnees != 'Error') {                                if(data!=0){                                    $('#warning-repas').empty();                                }                            }else{                                toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                            }                        },                        'text'                    );                }            });                    }                function ModifRepas($Jour) {            //console.log($('#ModifRepas').attr('name'));            $('#numberUpdateRepas').val($('#ModifRepas').attr('name'));            $("#ModalUpdateRepas").modal('show');                        $('#saveNbRepas').click(function(){                $("#ModalUpdateRepas").modal('hide');                $res = $('#numberUpdateRepas').val();                //console.log($res);                $.post(                    './ajax/UpdateRepas.php',                    {                        JourSelect : $Jour,                        nbRepas : $res,                    },                    function(data) {                        //console.log(data);                        $donnees = data.trim().substring(0,5);                        if($donnees != 'Error') {                            $valueBis = '"'+$Jour+'"';                            if(data!=0){                                $('#warning-repas').empty();                                $('#warning-repas').append($("<div class='col-lg-12 animated alert alert-danger' id='warning-info'><h5><i class='fa fa-info-circle' aria-hidden='true'></i> Réservation de Repas</h5>Vous avez réservé "+$res+" repas pour cette journée &nbsp|&nbsp <i class='fa fa-pencil' id='ModifRepas' aria-hidden='true' name='"+$res+"' onclick='ModifRepas("+$valueBis+")'></i> &nbsp|&nbsp <i class='fa fa-window-close text-danger' title='Supprimer' aria-hidden='true' id='SupprRepas' onclick='deleteRepas("+$valueBis+")'></i></div>"));                            }                        }else{                            toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                        }                    },                    'text'                );            });                    }        function loadRepas(){            $.ajax({                url: "./ajax/insertRepasTer.php",                type: "POST",                async: true, // Mode synchrone                data: ({                    JourSelect : $value,                }),                success : function(data2){                    $donnees = data2.substring(0,5);                    //console.log($donnees);                    if($donnees != 'Error') {                        //console.log(data2);                        $res = data2.trim();                           $valueBis = '"'+$value+'"';                        //console.log($res);                        if($res != null && $res != ""){                            if($('#warning-repas').contents().length != 0){                                $('#warning-repas').empty();                            }                            $('#warning-repas').append($("<div class='col-lg-12 animated alert alert-danger' id='warning-info'><h5><i class='fa fa-info-circle' aria-hidden='true'></i> Réservation de Repas</h5>Vous avez réservé "+$res+" repas pour cette journée &nbsp|&nbsp <i class='fa fa-pencil' id='ModifRepas' aria-hidden='true' name='"+$res+"' onclick='ModifRepas("+$valueBis+")'></i> &nbsp|&nbsp <i class='fa fa-window-close text-danger' title='Supprimer' aria-hidden='true' id='SupprRepas' onclick='deleteRepas("+$valueBis+")'></i></div>"));                                                                                }else{                            //console.log("error");                            $('#warning-repas').empty();                        }                                            }                    else {                        toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                            }                }            });        }        function load(){            //ICI            var $TESTarray = [];            $TESTarray = [];            $('#tableRDV th').each(function(){                if($(this).attr('id') != undefined){                    $TESTarray.push($(this).attr('id'));                }            });            $.post(                './ajax/DocReady.php',                {                },                function(data) {                    $donnees = data.trim().substring(0,5);                    if($donnees != 'Error') {                        //console.log(data);                        $obj = JSON.parse(data);                        //console.log($obj);                        $obj.forEach(function(value){                                                        $obj0 = value[2]; //nom du commercial                            $obj1 = value[1]; //nom de l'entreprise                            $obj2 = value[3]; //id entreprise                            $obj3 = value[4]; //id commercial                            //console.log($obj1);                            $('#tableRDV tbody').append($("<tr id="+'Provider'+$obj2+'-'+'Commercial'+$obj3+" toto="+$obj2+"></tr>"));                            $('#Provider'+$obj2+'-'+'Commercial'+$obj3).append($("<td id="+'Provider'+$obj2+">"+$obj1+"</td>"));                            $('#Provider'+$obj2+'-'+'Commercial'+$obj3).append($("<td id="+'Commercial'+$obj3+">"+$obj0+"</td>"));                            $TESTarray.forEach(function(val){                                $('#Provider'+$obj2+'-'+'Commercial'+$obj3).append($("<td id="+'Provider'+$obj2+'-'+'Heure'+val.substring(0,8)+"></td>"));                            });                                                    });                                            }                },                'text'            );        }        function LoadPrisesDeRdv(ListDateTableau1, tableAllIdFournisseurs2, thLunch3){            $.post(                './ajax/LoadPrisesDeRdv.php',                {                    ListDateTableau : ListDateTableau1, //liste des id de tous les th au format : "2019-04-23 08:00:00 - 08:30:00"                    tableAllIdFournisseurs : tableAllIdFournisseurs2,                    thLunch : thLunch3,                },                function(data) {                    //console.log(data);                    $donnees = data.trim().substring(0,5);                    //console.log($donnees);                    if($donnees != 'Error') {                        //toastr.success('Action réussie', 'Succès.');                        //console.log(data);                        $obj = JSON.parse(data);                        //console.log($obj);                            $obj.forEach(function(idFr){                                $obj0 = idFr[0]; //array des indispos du commerciale selectionné                                $obj1 = idFr[1]; //nom du commerciale                                $obj2 = idFr[2]; //nom Entreprise                                $obj3 = idFr[3]; //arrayAllPriseRDVForAllDays                                $obj4 = idFr[4]; //arrayIndisposRelatedToRdvWithOtherProvider                                $obj5 = idFr[5]; //arrayIndisposRelatedToSameHourWithOtherStoreWithSp                                $obj6 = idFr[6]; //id Fournisseur                                $obj7 = idFr[7]; //id Commercial                                $obj8 = idFr[8]; //fournisseurs avec qui on a déja pris en rdv;                                //console.log($obj8.length);                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).empty();                                    $string = "";                                    if($obj8.length != 0){                                        $string = "RDV déja pris : le ";                                        $obj8["RdvAutreJour"].forEach(function(objBis) {                                            if($.inArray( objBis, $obj8["RdvAutreJour"]) == 0){                                                $string = $string+' '+objBis["jourRdv"]+' de '+objBis["heureDebutRdv"]+' à '+objBis["heureFinRdv"];                                            }else{                                                $string = $string+'; le '+objBis["jourRdv"]+' de '+objBis["heureDebutRdv"]+' à '+objBis["heureFinRdv"];                                            }                                        });                                        $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Provider'+$obj6+" style='background-color:rgba(253,255,176,1.0)' title='"+$string+"'>"+$obj2+"</td>"));                                        $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Commercial'+$obj7+" style='background-color:rgba(253,255,176,1.0)' title='"+$string+"'>"+$obj1+"</td>"));                                    }else{                                        $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Provider'+$obj6+">"+$obj2+"</td>"));                                        $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Commercial'+$obj7+">"+$obj1+"</td>"));                                    }                                        //console.log($arrayListDateTableau);                                        ListDateTableau1.forEach(function(idTh) {                                            //console.log(idTh.length);                                                                                        $indispo = idTh.substring(11,30);                                            //console.log(idTh);                                            //console.log($indispo);                                            $idthBis = idTh.substring(0,10)+idTh.substring(11,19)+idTh.substring(22,30);                                            //console.log($idthBis);                                            if(idTh.substring(11) != thLunch3){                                                var $ref = '0';                                                $ref = '0';                                                //console.log(idTh);                                                // affichage des indispos des fournisseurs renseignées initialement                                                $refter = '0';                                                $obj0.forEach(function(HeureIndispo1) {                                                                                                        if($indispo == HeureIndispo1){                                                        $ref = '1';                                                        $refter = '1';                                                        $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Indisponibilité du Commercial' id='obj' style='background-image: url(img/hachures-rouges.png);'></td>"));                                                    }                                                                                                  });                                                // affichage des RDV magasins - commerciaux                                                $obj3.forEach(function(HeureIndispo2) {                                                    HeureIndispo2.forEach(function(HeureIndispo2bis){                                                        HeureIndispo2bis.forEach(function(test3){                                                            $debut = HeureIndispo2bis[0].substring(0,8);                                                            //console.log($debut);                                                            if($indispo == test3){                                                                //console.log(HeureIndispo2bis);                                                                $ref = '1';                                                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td name="+$idthBis+" value="+$obj6+" title='Rendez-vous enregistré' id='objBis' class='objBis' style='background-color:rgba(44,195,107,1.0)' val="+$obj6+" who="+'rdv'+" debut="+$debut+" com="+$obj1+" pro="+$obj2+" probis="+$obj2+"></td>"));                                                            }                                                        });                                                                                                            });                                                });                                                // affichage des indispos des commerciaux lié aux RDV qui ont été pris avec eux par un autre magasin                                                $refbis = '0';                                                $obj5.forEach(function(HeureIndispo4) {                                                    HeureIndispo4.forEach(function(test1){                                                                                                            test1[1].forEach(function(HeureIndispo4bis){                                                            if($indispo == HeureIndispo4bis && $refter == '0'){                                                                $ref = '1';                                                                $refbis = '1';                                                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Créneau déjà réservé par un autre participant' id='obj' style='background-color:rgba(234,97,83,1.0)'></td>"));                                                            }                                                        });                                                    });                                                });                                                // affichage des indispos de prise de RDV car un rdv a déja été pris avec un autre fournisseur le même durant le même créneau horaire                                                $obj4.forEach(function(HeureIndispo3) {                                                    HeureIndispo3.forEach(function(test){                                                        test[1].forEach(function(HeureIndispo3bis){                                                            if($indispo == HeureIndispo3bis && $refbis == '0' && $refter == '0'){                                                                $ref = '1';                                                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Créneau indisponible lié à RDV avec un autre participant' id='obj' style='background-image: url(img/hachures.png);'></td>"));                                                            }                                                          });                                                                                                            });                                                                     });                                                // affichage des disponibilitées pour les prise de RDV                                                if($ref == '0'){                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td name="+$idthBis+" id='objBis' val="+$obj6+" who="+'vide'+" com="+$obj1+" pro="+$obj2+"></td>"));                                                }                                            }else{                                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Pause Déjeuner' id='obj' style='padding:0;background-color:#f1f3f6;vertical-align:middle;text-align:center'><i class='fa fa-cutlery' aria-hidden='true'></i></td>"));                                            }                                        });                            });                                            }                    else {                        if(data.trim() == "Error1"/* && $a1 == "0"*/){                            //$a1 = "1";                            toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                        }else if(data.trim() == "Error2"){                            alert("Le créneau horaire comporte une erreur.");                        }else if(data.trim() == "Error3"){                            alert("Vous avez déja pris un Rendez-vous avec cette commission durant le même créneau horaire");                        }else if(data.trim() == "Error4"){                            toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                        }else if(data.trim() == "Error5"){                            alert("Le créneau horaire indiqué est placé sur une indisponibilitée de la commission");                        }else if(data.trim() == "Error6"){                        }else{                            toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                        }                    }                },                'text'            );        }        function TakePrisesDeRdv(jour_datetime, start_datetime, nomCom, nomProv, idFournisseur){            $("#exampleModalCenter").modal('hide');            $dureerdv = $('#dureerdv').val();            $tableAllIdFournisseurs = [];            $tableAllIdFournisseursbis = [];            if('.table-responsive:eq(0)' != undefined){                $('.table-responsive:eq(0) tbody tr').each(function(index){                    $tableAllIdFournisseursbis = [];                    $tableAllIdFournisseursbis.push($(this).find('td:first').attr('id').substring(8)); //id fournisseur                    $tableAllIdFournisseursbis.push($(this).find('td:eq(1)').attr('id').substring(10)); //id commercial                    $tableAllIdFournisseursbis.push($(this).attr('id')); //id tr                    $tableAllIdFournisseursbis.push($(this).find('td:first').html()); //nom fournisseur                    $tableAllIdFournisseursbis.push($(this).find('td:eq(1)').html()); //nom commercial                    $tableAllIdFournisseurs[index] = $tableAllIdFournisseursbis;                });            }            var $thLunch = "";            var $TESTarray = [];            $('#tableRDV th').each(function(){                if($(this).attr('name') == "thLunch"){                    $thLunch = $(this).attr('id').substring(11,30);                }                if($(this).attr('id') != undefined){                    $TESTarray.push($(this).attr('id'));                }            });            $.post(                './ajax/takeRdvStore.php',                {                    JourSelect : jour_datetime,                    StartTime : start_datetime,                    //EndTime : $endtime,                    NomCommercial : nomCom,                    NomFournisseur : nomProv,                    idFournisseur : idFournisseur,                    tableAllIdFournisseurs : $tableAllIdFournisseurs,                    thLunch : $thLunch,                    dureerdv : $dureerdv,                },                function(data) {                    //console.log("test");                    //console.log(data);                    $donnees = data.trim().substring(0,5);                    //console.log($donnees);                    if($donnees != 'Error') {                        //console.log("funciton");                        //console.log(data);                        $obj = JSON.parse(data);                        //console.log($obj);                        $obj.forEach(function(idFr){                            $obj0 = idFr[0]; //array des indispos du commerciale selectionné                            $obj1 = idFr[1]; //nom du commerciale                            $obj2 = idFr[2]; //nom Entreprise                            $obj3 = idFr[3]; //arrayAllPriseRDVForAllDays                            $obj4 = idFr[4]; //arrayIndisposRelatedToRdvWithOtherProvider                            $obj5 = idFr[5]; //arrayIndisposRelatedToSameHourWithOtherStoreWithSp                            $obj6 = idFr[6]; //id Fournisseur                            $obj7 = idFr[7]; //id Commercial                            $obj8 = idFr[8]; //fournisseurs avec qui on a déja pris en rdv;                            //console.log($obj8);                            //console.log($obj6);                            //console.log('Provider'+$obj6+'-'+'Commercial'+$obj7);                            //if(idtr[2] == 'Provider'+$obj6+'-'+'Commercial'+$obj7){                                //console.log("oui");                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).empty();                            $string = "";                            if($obj8.length != 0){                                $string = "RDV déja pris : le ";                                $obj8["RdvAutreJour"].forEach(function(objBis) {                                    if($.inArray( objBis, $obj8["RdvAutreJour"]) == 0){                                        $string = $string+' '+objBis["jourRdv"]+' de '+objBis["heureDebutRdv"]+' à '+objBis["heureFinRdv"];                                    }else{                                        $string = $string+'; le '+objBis["jourRdv"]+' de '+objBis["heureDebutRdv"]+' à '+objBis["heureFinRdv"];                                    }                                });                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Provider'+$obj6+" style='background-color:rgba(253,255,176,1.0)' title='"+$string+"'>"+$obj2+"</td>"));                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Commercial'+$obj7+" style='background-color:rgba(253,255,176,1.0)' title='"+$string+"'>"+$obj1+"</td>"));                            }else{                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Provider'+$obj6+">"+$obj2+"</td>"));                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Commercial'+$obj7+">"+$obj1+"</td>"));                            }                            //console.log($arrayListDateTableau);                            $TESTarray.forEach(function(idTh) {                                //console.log(idTh.length);                                $indispo = idTh.substring(11,30);                                //console.log(idTh);                                //console.log($indispo);                                $idthBis = idTh.substring(0,10)+idTh.substring(11,19)+idTh.substring(22,30);                                //console.log($idthBis);                                if(idTh.substring(11) != $thLunch){                                    var $ref = '0';                                    $ref = '0';                                    //console.log(idTh);                                    // affichage des indispos des fournisseurs renseignées initialement                                    $refter = '0';                                    $obj0[0].forEach(function(HeureIndispo1) {                                                                                if($indispo == HeureIndispo1){                                            $ref = '1';                                            $refter = '1';                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Indisponibilité du Commercial' id='obj' style='background-image: url(img/hachures-rouges.png);'></td>"));                                        }                                                                          });                                    // affichage des RDV magasins - commerciaux                                    $obj3.forEach(function(HeureIndispo2) {                                        HeureIndispo2.forEach(function(HeureIndispo2bis){                                            HeureIndispo2bis.forEach(function(test3){                                                $debut = HeureIndispo2bis[0].substring(0,8);                                                if($indispo == test3){                                                    //console.log(HeureIndispo2bis);                                                    $ref = '1';                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td name="+$idthBis+" value="+$obj6+" title='Rendez-vous enregistré' id='objBis' class='objBis' style='background-color:rgba(44,195,107,1.0)' val="+$obj6+" who="+'rdv'+" debut="+$debut+" com="+$obj1+" pro="+$obj2+" probis="+$obj2+"></td>"));                                                }                                            });                                        });                                    });                                    // affichage des indispos des commerciaux lié aux RDV qui ont été pris avec eux par un autre magasin                                    $refbis = '0';                                    $obj5.forEach(function(HeureIndispo4) {                                        HeureIndispo4.forEach(function(test1){                                                                                    test1[1].forEach(function(HeureIndispo4bis){                                                if($indispo == HeureIndispo4bis && $refter == '0'){                                                    $ref = '1';                                                    $refbis = '1';                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Créneau déjà réservé par un autre participant' id='obj' style='background-color:rgba(234,97,83,1.0)'></td>"));                                                }                                            });                                        });                                    });                                    // affichage des indispos de prise de RDV car un rdv a déja été pris avec un autre fournisseur le même durant le même créneau horaire                                    $obj4.forEach(function(HeureIndispo3) {                                        HeureIndispo3.forEach(function(test){                                            test[1].forEach(function(HeureIndispo3bis){                                                if($indispo == HeureIndispo3bis && $refbis == '0' && $refter == '0'){                                                    $ref = '1';                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Créneau indisponible lié à RDV avec un autre participant' id='obj' style='background-image: url(img/hachures.png);'></td>"));                                                }                                              });                                                                                    });                                                         });                                    // affichage des disponibilitées pour les prise de RDV                                    if($ref == '0'){                                        $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td name="+$idthBis+" id='objBis' val="+$obj6+" who="+'vide'+" com="+$obj1+" pro="+$obj2+"></td>"));                                    }                                }else{                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Pause Déjeuner' id='obj' style='padding:0;background-color:#f1f3f6;vertical-align:middle;text-align:center'><i class='fa fa-cutlery' aria-hidden='true'></i></td>"));                                }                            });                        });                                            }                    else {                        if(data.trim() == "Error1"){                            //console.log("1");                            toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                        }else if(data.trim() == "Error2"){                            //console.log("2");                            alert("Le créneau horaire comporte une erreur.");                        }else if(data.trim() == "Error3"){                            //console.log("3");                            alert("Vous avez déja pris un Rendez-vous avec cette commission durant le même créneau horaire");                        }else if(data.trim() == "Error4"){                            //console.log("4");                            alert("Le créneau horaire indiqué est placé sur une indisponibilitée de la commission");                            //toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                        }else if(data.trim() == "Error5"){                            //console.log("5");                            alert("Le créneau horaire indiqué est placé sur une indisponibilitée de la commission");                        }else if(data.trim() == "Error6"){                            /*console.log("6");                            alert("Veuillez selectionner un Jour pour la prise de Rendez-vous");*/                        }else if(data.trim() == "Error7"){                            //console.log("7");                            alert("Veuillez selectionner un Fournisseur pour la prise de Rendez-vous");                        }else if(data.trim() == "Error8"){                            //console.log("8");                            alert("Le Rendez-vous ne peut pas être pris durant la pause Déjeuner");                        }else if(data.trim() == "Error9"){                            //console.log("8");                            alert("Le créneau horaire contient une erreur");                        }else{                            //console.log("9");                            toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                        }                    }                },                'text'            );        }/*----------------------------------------------------------------------------------------------------------------------------------*/        $(document).ready(function(){//le script s'execute au chargement de la page            $toto = <?php echo json_encode($_SESSION['purchasingFairConcerned']->getStartDatetime()); ?>;            $value = $toto.substring(0,10);            var $TESTarray = [];            $TESTarray = [];            $('#tableRDV th').each(function(){                if($(this).attr('id') != undefined){                    $TESTarray.push($(this).attr('id'));                }            });            $.post(                './ajax/DocReady.php',                {                },                function(data) {                    $donnees = data.trim().substring(0,5);                    if($donnees != 'Error') {                        $obj = JSON.parse(data);                        $tableAllIdFournisseurs = [];                        $tableAllIdFournisseursbis = [];                        $obj.forEach(function(element, index, array){                            //console.log(index);                            $tableAllIdFournisseursbis = [];                            $tableAllIdFournisseursbis.push(element[3]); //id fournisseur                            $tableAllIdFournisseursbis.push(element[4]); //id commercial                            $tableAllIdFournisseursbis.push("toto"); //id tr                            $tableAllIdFournisseursbis.push(element[1]); //nom fournisseur                            $tableAllIdFournisseursbis.push(element[2]); //nom commercial                            $tableAllIdFournisseurs[index] = $tableAllIdFournisseursbis;                        });                        //console.log($tableAllIdFournisseurs);                                                //console.log($obj);                        $obj.forEach(function(value){                                                        $obj0 = value[2]; //nom du commercial                            $obj1 = value[1]; //nom de l'entreprise                            $obj2 = value[3]; //id entreprise                            $obj3 = value[4]; //id commercial                            //console.log($obj1);                            $('#tableRDV tbody').append($("<tr id="+'Provider'+$obj2+'-'+'Commercial'+$obj3+" toto="+$obj2+"></tr>"));                            $('#Provider'+$obj2+'-'+'Commercial'+$obj3).append($("<td id="+'Provider'+$obj2+">"+$obj1+"</td>"));                            $('#Provider'+$obj2+'-'+'Commercial'+$obj3).append($("<td id="+'Commercial'+$obj3+">"+$obj0+"</td>"));                            $TESTarray.forEach(function(val){                                $('#Provider'+$obj2+'-'+'Commercial'+$obj3).append($("<td id="+'Provider'+$obj2+'-'+'Heure'+val.substring(0,8)+"></td>"));                            });                                                    });                                            }                },                'text'            );            (function teste(){                $test = 0;                $.post(                    './ajax/FlagSelectJour.php',                    {                        JourSelect : $value,                    },                    function(data) {                        //console.log(data);                        $donnees = data.trim().substring(0,3);                        if($donnees == 'Log') {                            //console.log(data);                            $test ++;                                                        $('#planning-main').hide();                            $('#planning-main').css(["display","none"]);                            if($test<=1){                                $('#block-warning').append($("<div class='col-lg-12 animated alert alert-danger' id='warning-info'><h5><i class='fa fa-info-circle' aria-hidden='true'></i> Saisie indisponible pour le moment</h5>Un magasin est en train d'effectuer sa prise de Rendez-vous pour ce jour</div>"));                            }                            /*myVar = setInterval(teste, 1000);                            if($test>1){                                clearInterval(myVar);                                delete myVar;                            }*/                            //return $test;                            //console.log($test);                                                    }                        else {                            //$test ++;                            //delete myVar;                            $('#warning-info').remove();                            $('#planning-main').show();                            $('#submitRDV').show();                            //return $test;                            //return "else";                            //console.log($test);                                                    }                                            },                    'text'                );            })();            loadRepas();            $.post(                './ajax/DocReadyDisplayDaySelect.php',                {                    jourSelect : $value,                },                function(data) {                    $donnees = data.trim().substring(0,5);                    if($donnees != 'Error') {                        $obj = JSON.parse(data);                        $obj0 = $obj[0][1]; //jour : lundi                        $obj1 = $obj[0][2]; //num : 24                        $obj2 = $obj[0][3]; //mois : avril                        //console.log($obj0);                        $('#dayclick').empty();                        $('#dayclick').append($("<i class='fa fa-calendar' aria-hidden='true'></i><i>"+$obj0+' '+$obj1+' '+$obj2+'</i>'));                        var $thLunch = "";                          var $TESTarray = []; //arrayListDateTableau                        $('#tableRDV th').each(function(){                            var $idTh = $(this).attr('id');                            if($idTh != undefined){                                if($idTh.length != 19){                                    $idTh = $idTh.slice(-19);                                }                                $(this).prop('id', $value+' '+$idTh); // 2019-04-28 18:30:00 - 19:00:00                                //console.log($(this).attr('id'));                                $TESTarray.push($(this).attr('id'));                            }                            if($(this).attr('name') == "thLunch"){                                //console.log($(this).attr('id'));                                $thLunch = $(this).attr('id');                            }                        });                        $.post(                            './ajax/LoadPrisesDeRdv.php',                            {                                ListDateTableau : $TESTarray, //liste des id de tous les th au format : "2019-04-23 08:00:00 - 08:30:00"                                tableAllIdFournisseurs : $tableAllIdFournisseurs,                                thLunch : $thLunch,                            },                            function(data) {                                //console.log(data);                                $donnees = data.trim().substring(0,5);                                //console.log($donnees);                                if($donnees != 'Error') {                                    //toastr.success('Action réussie', 'Succès.');                                    //console.log(data);                                    $obj = JSON.parse(data);                                    //console.log($obj);                                        $obj.forEach(function(idFr){                                            $obj0 = idFr[0]; //array des indispos du commerciale selectionné                                            $obj1 = idFr[1]; //nom du commerciale                                            $obj2 = idFr[2]; //nom Entreprise                                            $obj3 = idFr[3]; //arrayAllPriseRDVForAllDays                                            $obj4 = idFr[4]; //arrayIndisposRelatedToRdvWithOtherProvider                                            $obj5 = idFr[5]; //arrayIndisposRelatedToSameHourWithOtherStoreWithSp                                            $obj6 = idFr[6]; //id Fournisseur                                            $obj7 = idFr[7]; //id Commercial                                            $obj8 = idFr[8]; //fournisseurs avec qui on a déja pris en rdv;                                            //console.log($obj8["RdvAutreJour"]);                                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).empty();                                                $string = "";                                                if($obj8.length != 0){                                                    $string = "RDV déja pris : le ";                                                    $obj8["RdvAutreJour"].forEach(function(objBis) {                                                        if($.inArray( objBis, $obj8["RdvAutreJour"]) == 0){                                                            $string = $string+' '+objBis["jourRdv"]+' de '+objBis["heureDebutRdv"]+' à '+objBis["heureFinRdv"];                                                        }else{                                                            $string = $string+'; le '+objBis["jourRdv"]+' de '+objBis["heureDebutRdv"]+' à '+objBis["heureFinRdv"];                                                        }                                                    });                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Provider'+$obj6+" style='background-color:rgba(253,255,176,1.0)' title='"+$string+"'>"+$obj2+"</td>"));                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Commercial'+$obj7+" style='background-color:rgba(253,255,176,1.0)' title='"+$string+"'>"+$obj1+"</td>"));                                                }else{                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Provider'+$obj6+">"+$obj2+"</td>"));                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Commercial'+$obj7+">"+$obj1+"</td>"));                                                }                                                    //console.log($arrayListDateTableau);                                                    $TESTarray.forEach(function(idTh) {                                                        //console.log(idTh.length);                                                                                                                $indispo = idTh.substring(11,30);                                                        //console.log(idTh);                                                        //console.log($indispo);                                                        $idthBis = idTh.substring(0,10)+idTh.substring(11,19)+idTh.substring(22,30);                                                        //console.log($idthBis);                                                        if(idTh != $thLunch){                                                            var $ref = '0';                                                            $ref = '0';                                                            //console.log(idTh);                                                            // affichage des indispos des fournisseurs renseignées initialement                                                            $refter = '0';                                                            $obj0.forEach(function(HeureIndispo1) {                                                                //console.log(HeureIndispo1);                                                                                                                                if($indispo == HeureIndispo1){                                                                    $ref = '1';                                                                    $refter = '1';                                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Indisponibilité du Commercial' id='obj' style='background-image: url(img/hachures-rouges.png);'></td>"));                                                                }                                                                                                                          });                                                            // affichage des RDV magasins - commerciaux                                                            $obj3.forEach(function(HeureIndispo2) {                                                                HeureIndispo2.forEach(function(HeureIndispo2bis){                                                                    HeureIndispo2bis.forEach(function(test3){                                                                        $debut = HeureIndispo2bis[0].substring(0,8);                                                                        //console.log($debut);                                                                        if($indispo == test3){                                                                            //console.log(HeureIndispo2bis);                                                                            $ref = '1';                                                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td name="+$idthBis+" value="+$obj6+" title='Rendez-vous enregistré' id='objBis' class='objBis' style='background-color:rgba(44,195,107,1.0)' val="+$obj6+" who="+'rdv'+" debut="+$debut+" com="+$obj1+" pro="+$obj2+" probis="+$obj2+"></td>"));                                                                        }                                                                    });                                                                                                                                    });                                                            });                                                            // affichage des indispos des commerciaux lié aux RDV qui ont été pris avec eux par un autre magasin                                                            $refbis = '0';                                                            $obj5.forEach(function(HeureIndispo4) {                                                                HeureIndispo4.forEach(function(test1){                                                                                                                                    test1[1].forEach(function(HeureIndispo4bis){                                                                        if($indispo == HeureIndispo4bis && $refter == '0'){                                                                            $ref = '1';                                                                            $refbis = '1';                                                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Créneau déjà réservé par un autre participant' id='obj' style='background-color:rgba(234,97,83,1.0)'></td>"));                                                                        }                                                                    });                                                                });                                                            });                                                            // affichage des indispos de prise de RDV car un rdv a déja été pris avec un autre fournisseur le même durant le même créneau horaire                                                            $obj4.forEach(function(HeureIndispo3) {                                                                HeureIndispo3.forEach(function(test){                                                                    test[1].forEach(function(HeureIndispo3bis){                                                                        if($indispo == HeureIndispo3bis && $refbis == '0' && $refter == '0'){                                                                            $ref = '1';                                                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Créneau indisponible lié à RDV avec un autre participant' id='obj' style='background-image: url(img/hachures.png);'></td>"));                                                                        }                                                                      });                                                                                                                                    });                                                                                 });                                                            // affichage des disponibilitées pour les prise de RDV                                                            if($ref == '0'){                                                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td name="+$idthBis+" id='objBis' val="+$obj6+" who="+'vide'+" com="+$obj1+" pro="+$obj2+"></td>"));                                                            }                                                        }else{                                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Pause Déjeuner' id='obj' style='padding:0;background-color:#f1f3f6;vertical-align:middle;text-align:center'><i class='fa fa-cutlery' aria-hidden='true'></i></td>"));                                                        }                                                    });                                        });                                                                                }                                else {                                    if(data.trim() == "Error1"){                                        toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                    }else if(data.trim() == "Error2"){                                        alert("Le créneau horaire comporte une erreur.");                                    }else if(data.trim() == "Error3"){                                        alert("Vous avez déja pris un Rendez-vous avec cette commission durant le même créneau horaire");                                    }else if(data.trim() == "Error4"){                                        toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                    }else if(data.trim() == "Error5"){                                        alert("Le créneau horaire indiqué est placé sur une indisponibilitée de la commission");                                    }else if(data.trim() == "Error6"){                                    }else{                                        toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                    }                                }                            },                            'text'                        );                                                                    }                },                'text'            );        });/*----------------------------------------------------------------------------------------------------------------------------------*/        $cptt=0;        $('.btsdate').click(function(){            $cptt++;            $val = $(this).attr('value');            $value = $val.substring(4,14);            //console.log($value);            (function teste(){                $test = 0;                $.post(                    './ajax/FlagSelectJour.php',                    {                        JourSelect : $value,                    },                    function(data) {                        //console.log(data);                        $donnees = data.trim().substring(0,3);                        if($donnees == 'Log') {                            //console.log(data);                            $test ++;                                                        $('#planning-main').hide();                            $('#planning-main').css(["display","none"]);                            if($test<=1){                                $('#block-warning').append($("<div class='col-lg-12 animated alert alert-danger' id='warning-info'><h5><i class='fa fa-info-circle' aria-hidden='true'></i> Saisie indisponnible pour le moment</h5>Un magasin est en train d'effectuer sa prise de Rendez-vous pour ce jour</div>"));                            }                            /*myVar = setInterval(teste, 1000);                            if($test>1){                                clearInterval(myVar);                                delete myVar;                            }*/                            //return $test;                            //console.log($test);                                                    }                        else {                            //$test ++;                            //delete myVar;                            $('#warning-info').remove();                            $('#planning-main').show();                            $('#submitRDV').show();                            //return $test;                            //return "else";                            //console.log($test);                                                    }                                            },                    'text'                );            })();            loadRepas();            $tableAllIdFournisseurs = [];            $tableAllIdFournisseursbis = [];            if('.table-responsive:eq(0)' != undefined){                $('.table-responsive:eq(0) tbody tr').each(function(index){                    $tableAllIdFournisseursbis = [];                    $tableAllIdFournisseursbis.push($(this).find('td:first').attr('id').substring(8)); //id fournisseur                    $tableAllIdFournisseursbis.push($(this).find('td:eq(1)').attr('id').substring(10)); //id commercial                    $tableAllIdFournisseursbis.push($(this).attr('id')); //id tr                    $tableAllIdFournisseursbis.push($(this).find('td:first').html()); //nom fournisseur                    $tableAllIdFournisseursbis.push($(this).find('td:eq(1)').html()); //nom commercial                    $tableAllIdFournisseurs[index] = $tableAllIdFournisseursbis;                    //console.log($(this).attr('id'));                });            }            //console.log($tableAllIdFournisseurs);            $.post(                './ajax/DocReadyDisplayDaySelect.php',                {                    jourSelect : $value,                },                function(data) {                    $donnees = data.trim().substring(0,5);                    if($donnees != 'Error') {                        $obj = JSON.parse(data);                        $obj0 = $obj[0][1]; //jour : lundi                        $obj1 = $obj[0][2]; //num : 24                        $obj2 = $obj[0][3]; //mois : avril                        //console.log($obj0);                        $('#dayclick').empty();                        $('#dayclick').append($("<i class='fa fa-calendar' aria-hidden='true'></i><i>"+$obj0+' '+$obj1+' '+$obj2+'</i>'));                        var $thLunch = "";                          var $TESTarray = []; //arrayListDateTableau                        $('#tableRDV th').each(function(){                            var $idTh = $(this).attr('id');                            if($idTh != undefined){                                if($idTh.length != 19){                                    $idTh = $idTh.slice(-19);                                }                                $(this).prop('id', $value+' '+$idTh); // 2019-04-28 18:30:00 - 19:00:00                                //console.log($(this).attr('id'));                                $TESTarray.push($(this).attr('id'));                            }                            if($(this).attr('name') == "thLunch"){                                //console.log($(this).attr('id'));                                $thLunch = $(this).attr('id');                            }                        });                        $.post(                            './ajax/LoadPrisesDeRdv.php',                            {                                ListDateTableau : $TESTarray, //liste des id de tous les th au format : "2019-04-23 08:00:00 - 08:30:00"                                tableAllIdFournisseurs : $tableAllIdFournisseurs,                                thLunch : $thLunch,                            },                            function(data) {                                //console.log(data);                                $donnees = data.trim().substring(0,5);                                //console.log($donnees);                                if($donnees != 'Error') {                                    //toastr.success('Action réussie', 'Succès.');                                    //console.log(data);                                    $obj = JSON.parse(data);                                    //console.log($obj);                                        $obj.forEach(function(idFr){                                            $obj0 = idFr[0]; //array des indispos du commerciale selectionné                                            $obj1 = idFr[1]; //nom du commerciale                                            $obj2 = idFr[2]; //nom Entreprise                                            $obj3 = idFr[3]; //arrayAllPriseRDVForAllDays                                            $obj4 = idFr[4]; //arrayIndisposRelatedToRdvWithOtherProvider                                            $obj5 = idFr[5]; //arrayIndisposRelatedToSameHourWithOtherStoreWithSp                                            $obj6 = idFr[6]; //id Fournisseur                                            $obj7 = idFr[7]; //id Commercial                                            $obj8 = idFr[8]; //fournisseurs avec qui on a déja pris en rdv;                                            //console.log($obj8["RdvAutreJour"]);                                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).empty();                                                $string = "";                                                if($obj8.length != 0){                                                    $string = "RDV déja pris : le ";                                                    $obj8["RdvAutreJour"].forEach(function(objBis) {                                                        if($.inArray( objBis, $obj8["RdvAutreJour"]) == 0){                                                            $string = $string+' '+objBis["jourRdv"]+' de '+objBis["heureDebutRdv"]+' à '+objBis["heureFinRdv"];                                                        }else{                                                            $string = $string+'; le '+objBis["jourRdv"]+' de '+objBis["heureDebutRdv"]+' à '+objBis["heureFinRdv"];                                                        }                                                    });                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Provider'+$obj6+" style='background-color:rgba(253,255,176,1.0)' title='"+$string+"'>"+$obj2+"</td>"));                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Commercial'+$obj7+" style='background-color:rgba(253,255,176,1.0)' title='"+$string+"'>"+$obj1+"</td>"));                                                }else{                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Provider'+$obj6+">"+$obj2+"</td>"));                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Commercial'+$obj7+">"+$obj1+"</td>"));                                                }                                                    //console.log($arrayListDateTableau);                                                    $TESTarray.forEach(function(idTh) {                                                        //console.log(idTh.length);                                                                                                                $indispo = idTh.substring(11,30);                                                        //console.log(idTh);                                                        //console.log($indispo);                                                        $idthBis = idTh.substring(0,10)+idTh.substring(11,19)+idTh.substring(22,30);                                                        //console.log($idthBis);                                                        if(idTh != $thLunch){                                                            var $ref = '0';                                                            $ref = '0';                                                            //console.log(idTh);                                                            // affichage des indispos des fournisseurs renseignées initialement                                                            $refter = '0';                                                            $obj0.forEach(function(HeureIndispo1) {                                                                //console.log(HeureIndispo1);                                                                                                                                if($indispo == HeureIndispo1){                                                                    $ref = '1';                                                                    $refter = '1';                                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Indisponibilité du Commercial' id='obj' style='background-image: url(img/hachures-rouges.png);'></td>"));                                                                }                                                                                                                          });                                                            // affichage des RDV magasins - commerciaux                                                            $obj3.forEach(function(HeureIndispo2) {                                                                HeureIndispo2.forEach(function(HeureIndispo2bis){                                                                    HeureIndispo2bis.forEach(function(test3){                                                                        $debut = HeureIndispo2bis[0].substring(0,8);                                                                        //console.log($debut);                                                                        if($indispo == test3){                                                                            //console.log(HeureIndispo2bis);                                                                            $ref = '1';                                                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td name="+$idthBis+" value="+$obj6+" title='Rendez-vous enregistré' id='objBis' class='objBis' style='background-color:rgba(44,195,107,1.0)' val="+$obj6+" who="+'rdv'+" debut="+$debut+" com="+$obj1+" pro="+$obj2+" probis="+$obj2+"></td>"));                                                                        }                                                                    });                                                                                                                                    });                                                            });                                                            // affichage des indispos des commerciaux lié aux RDV qui ont été pris avec eux par un autre magasin                                                            $refbis = '0';                                                            $obj5.forEach(function(HeureIndispo4) {                                                                HeureIndispo4.forEach(function(test1){                                                                                                                                    test1[1].forEach(function(HeureIndispo4bis){                                                                        if($indispo == HeureIndispo4bis && $refter == '0'){                                                                            $ref = '1';                                                                            $refbis = '1';                                                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Créneau déjà réservé par un autre participant' id='obj' style='background-color:rgba(234,97,83,1.0)'></td>"));                                                                        }                                                                    });                                                                });                                                            });                                                            // affichage des indispos de prise de RDV car un rdv a déja été pris avec un autre fournisseur le même durant le même créneau horaire                                                            $obj4.forEach(function(HeureIndispo3) {                                                                HeureIndispo3.forEach(function(test){                                                                    test[1].forEach(function(HeureIndispo3bis){                                                                        if($indispo == HeureIndispo3bis && $refbis == '0' && $refter == '0'){                                                                            $ref = '1';                                                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Créneau indisponible lié à RDV avec un autre participant' id='obj' style='background-image: url(img/hachures.png);'></td>"));                                                                        }                                                                      });                                                                                                                                    });                                                                                 });                                                            // affichage des disponibilitées pour les prise de RDV                                                            if($ref == '0'){                                                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td name="+$idthBis+" id='objBis' val="+$obj6+" who="+'vide'+" com="+$obj1+" pro="+$obj2+"></td>"));                                                            }                                                        }else{                                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Pause Déjeuner' id='obj' style='padding:0;background-color:#f1f3f6;vertical-align:middle;text-align:center'><i class='fa fa-cutlery' aria-hidden='true'></i></td>"));                                                        }                                                    });                                        });                                                                                }                                else {                                    if(data.trim() == "Error1"){                                        toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                    }else if(data.trim() == "Error2"){                                        alert("Le créneau horaire comporte une erreur.");                                    }else if(data.trim() == "Error3"){                                        alert("Vous avez déja pris un Rendez-vous avec cette commission durant le même créneau horaire");                                    }else if(data.trim() == "Error4"){                                        toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                    }else if(data.trim() == "Error5"){                                        alert("Le créneau horaire indiqué est placé sur une indisponibilitée de la commission");                                    }else if(data.trim() == "Error6"){                                    }else{                                        toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                    }                                }                            },                            'text'                        );                                                                    }                },                'text'            );                    });    $start_datetime = "";    $jour_datetime = "";    $idFournisseur = "";    $nomEntreprise = "";    $who = "";    $nomCom = "";    $nomProv = "";    $debut = "";    $(".table-responsive").on("click", "#objBis", function() {        $start_datetime = $(this).attr('name').substring(10,18);        $jour_datetime = $(this).attr('name').substring(0,10);        $idFournisseur = $(this).attr('val');        $nomEntreprise = 2;        $who = $(this).attr('who');        $nomCom = $(this).attr('com');        $nomProv = $(this).attr('pro');        $debut = $(this).attr('debut');        //console.log($start_datetime);        $('input[type=radio][name=btradio][value=Y]').attr('checked', false);        if($who == "vide"){            $("#exampleModalCenter").modal('show');            $('#deleterdv').hide();            $('#heurerdv').empty();            $('#heurerdv').append($("<span>"+$start_datetime.substring(0,2)+'H '+$start_datetime.substring(3,5)+' avec '+$nomProv+"</span>"));                        $.post(                './ajax/insertRepas.php',                {                    JourSelect : $jour_datetime,                },                function(data) {                    //console.log(data);                    $donnees = data.trim().substring(0,5);                    //console.log($donnees);                    if($donnees != 'Error') {                        //console.log(data);                        $obj = data.trim();                        if($obj === "Success"){                            $('#hrRepas').css(["display","block"]);                            $('#hrRepas').show();                            $('#divRepasBis').css(["display","block"]);                            $('#divRepasBis').show();                            $('#DivNumberRepas').css(["display","none"]);                            $('#DivNumberRepas').hide();                            $('#btradioFalse').prop("checked", true);                        }else{                            $('#hrRepas').css(["display","none"]);                            $('#hrRepas').hide();                            $('#divRepasBis').css(["display","none"]);                            $('#divRepasBis').hide();                            $('#DivNumberRepas').css(["display","none"]);                            $('#DivNumberRepas').hide();                                                    }                    }                    else {                        toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                            }                },                'text'            );                    }else{            $('#hrRepas').css(["display","none"]);            $('#hrRepas').hide();            $('#divRepasBis').css(["display","none"]);            $('#divRepasBis').hide();            $('#DivNumberRepas').css(["display","none"]);            $('#DivNumberRepas').hide();            $time = 0;            $('.objBis').each(function(){                //console.log("ok");                if($(this).attr('probis') != undefined){                    if($(this).attr('probis') == $nomProv && $(this).attr('debut') == $debut){                        $time = $time + 30;                        //console.log($(this).attr('name'));                    }                }            });            $timeHeure = $time / 60;            $timeMin = $time % 60;            $("#exampleModalCenter").modal('show');            $('#deleterdv').show();            $('#heurerdv').empty();            $('#heurerdv').append($("<span>"+$debut.substring(0,2)+'H '+$debut.substring(3,5)+' avec '+$nomProv+"</span>"));            if($timeMin != 30){                if($timeHeure >= 1){                    $('#dureerdv').val('0'+($timeHeure+"").substring(0,1)+':00');                }else{                    $('#dureerdv').val('00:00');                }            }else{                if($timeHeure >= 1){                    $('#dureerdv').val('0'+($timeHeure+"").substring(0,1)+':'+$timeMin);                }else{                    $('#dureerdv').val('00:30');                }            }        }        //console.log($jour_datetime);        $cpt = 0;    });        $('#saverdv').click(function(){            $cpt++;                        if($cpt<=1){                if($who == "vide"){                    //console.log("test");                    $("#exampleModalCenter").modal('hide');                    $dureerdv = $('#dureerdv').val();                    //console.log($dureerdv);                    var $check = document.querySelector('input[name=btradio]:checked').value;                    var $nbrepas = $('#numberRepas').val();                    //console.log($nbrepas);                    //console.log($jour_datetime);                    $tableAllIdFournisseurs = [];                    $tableAllIdFournisseursbis = [];                    if('.table-responsive:eq(0)' != undefined){                        $('.table-responsive:eq(0) tbody tr').each(function(index){                            $tableAllIdFournisseursbis = [];                            $tableAllIdFournisseursbis.push($(this).find('td:first').attr('id').substring(8)); //id fournisseur                            $tableAllIdFournisseursbis.push($(this).find('td:eq(1)').attr('id').substring(10)); //id commercial                            $tableAllIdFournisseursbis.push($(this).attr('id')); //id tr                            $tableAllIdFournisseursbis.push($(this).find('td:first').html()); //nom fournisseur                            $tableAllIdFournisseursbis.push($(this).find('td:eq(1)').html()); //nom commercial                            $tableAllIdFournisseurs[index] = $tableAllIdFournisseursbis;                        });                    }                    var $thLunch = "";                    var $TESTarray = [];                    $('#tableRDV th').each(function(){                        if($(this).attr('name') == "thLunch"){                            $thLunch = $(this).attr('id').substring(11,30);                        }                        if($(this).attr('id') != undefined){                            $TESTarray.push($(this).attr('id'));                        }                    });                    $.post(                        './ajax/takeRdvStore.php',                        {                            JourSelect : $jour_datetime,                            StartTime : $start_datetime,                            //EndTime : $endtime,                            NomCommercial : $nomCom,                            NomFournisseur : $nomProv,                            idFournisseur : $idFournisseur,                            tableAllIdFournisseurs : $tableAllIdFournisseurs,                            thLunch : $thLunch,                            dureerdv : $dureerdv,                        },                        function(data) {                            //console.log(data);                            $donnees = data.trim().substring(0,5);                            //console.log($donnees);                            if($donnees != 'Error') {                                //ajout repas                                if($check == "Y" && $nbrepas != 0){                                    $.post(                                        './ajax/insertRepasBis.php',                                        {                                            check : $check,                                            nbrepas : $nbrepas,                                            jour_datetime : $jour_datetime,                                        },                                        function(data) {                                            //console.log(data);                                            $donnees = data.trim().substring(0,5);                                            if($donnees != 'Error') {                                                //console.log(data);                                                loadRepas();                                            }                                            else {                                                toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                                                                            }                                        },                                        'text'                                    );                                }                                //toastr.success('Action réussie', 'Succès.');                                //console.log(data);                                $obj = JSON.parse(data.trim());                                //console.log($obj);                                $obj.forEach(function(idFr){                                    $obj0 = idFr[0]; //array des indispos du commerciale selectionné                                    $obj1 = idFr[1]; //nom du commerciale                                    $obj2 = idFr[2]; //nom Entreprise                                    $obj3 = idFr[3]; //arrayAllPriseRDVForAllDays                                    $obj4 = idFr[4]; //arrayIndisposRelatedToRdvWithOtherProvider                                    $obj5 = idFr[5]; //arrayIndisposRelatedToSameHourWithOtherStoreWithSp                                    $obj6 = idFr[6]; //id Fournisseur                                    $obj7 = idFr[7]; //id Commercial                                    $obj8 = idFr[8]; //fournisseurs avec qui on a déja pris en rdv;                                    //console.log($obj6);                                    //console.log('Provider'+$obj6+'-'+'Commercial'+$obj7);                                    //if(idtr[2] == 'Provider'+$obj6+'-'+'Commercial'+$obj7){                                        //console.log("oui");                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).empty();                                    $string = "";                                    if($obj8.length != 0){                                        $string = "RDV déja pris : le ";                                        $obj8["RdvAutreJour"].forEach(function(objBis) {                                            if($.inArray( objBis, $obj8["RdvAutreJour"]) == 0){                                                $string = $string+' '+objBis["jourRdv"]+' de '+objBis["heureDebutRdv"]+' à '+objBis["heureFinRdv"];                                            }else{                                                $string = $string+'; le '+objBis["jourRdv"]+' de '+objBis["heureDebutRdv"]+' à '+objBis["heureFinRdv"];                                            }                                        });                                        $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Provider'+$obj6+" style='background-color:rgba(253,255,176,1.0)' title='"+$string+"'>"+$obj2+"</td>"));                                        $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Commercial'+$obj7+" style='background-color:rgba(253,255,176,1.0)' title='"+$string+"'>"+$obj1+"</td>"));                                    }else{                                        $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Provider'+$obj6+">"+$obj2+"</td>"));                                        $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td id="+'Commercial'+$obj7+">"+$obj1+"</td>"));                                    }                                    //console.log($arrayListDateTableau);                                    $TESTarray.forEach(function(idTh) {                                        //console.log(idTh.length);                                        $indispo = idTh.substring(11,30);                                        //console.log(idTh);                                        //console.log($indispo);                                        $idthBis = idTh.substring(0,10)+idTh.substring(11,19)+idTh.substring(22,30);                                        //console.log($idthBis);                                        if(idTh.substring(11) != $thLunch){                                            var $ref = '0';                                            $ref = '0';                                            //console.log(idTh);                                            // affichage des indispos des fournisseurs renseignées initialement                                            $refter = '0';                                            $obj0[0].forEach(function(HeureIndispo1) {                                                                                                if($indispo == HeureIndispo1){                                                    $ref = '1';                                                    $refter = '1';                                                    $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Indisponibilité du Commercial' id='obj' style='background-image: url(img/hachures-rouges.png);'></td>"));                                                }                                                                                          });                                            // affichage des RDV magasins - commerciaux                                            $obj3.forEach(function(HeureIndispo2) {                                                HeureIndispo2.forEach(function(HeureIndispo2bis){                                                    HeureIndispo2bis.forEach(function(test3){                                                        $debut = HeureIndispo2bis[0].substring(0,8);                                                        if($indispo == test3){                                                            //console.log(HeureIndispo2bis);                                                            $ref = '1';                                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td name="+$idthBis+" value="+$obj6+" title='Rendez-vous enregistré' id='objBis' class='objBis' style='background-color:rgba(44,195,107,1.0)' val="+$obj6+" who="+'rdv'+" debut="+$debut+" com="+$obj1+" pro="+$obj2+" probis="+$obj2+"></td>"));                                                        }                                                    });                                                });                                            });                                            // affichage des indispos des commerciaux lié aux RDV qui ont été pris avec eux par un autre magasin                                            $refbis = '0';                                            $obj5.forEach(function(HeureIndispo4) {                                                HeureIndispo4.forEach(function(test1){                                                                                                    test1[1].forEach(function(HeureIndispo4bis){                                                        if($indispo == HeureIndispo4bis && $refter == '0'){                                                            $ref = '1';                                                            $refbis = '1';                                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Créneau déjà réservé par un autre participant' id='obj' style='background-color:rgba(234,97,83,1.0)'></td>"));                                                        }                                                    });                                                });                                            });                                            // affichage des indispos de prise de RDV car un rdv a déja été pris avec un autre fournisseur le même durant le même créneau horaire                                            $obj4.forEach(function(HeureIndispo3) {                                                HeureIndispo3.forEach(function(test){                                                    test[1].forEach(function(HeureIndispo3bis){                                                        if($indispo == HeureIndispo3bis && $refbis == '0' && $refter == '0'){                                                            $ref = '1';                                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Créneau indisponible lié à RDV avec un autre participant' id='obj' style='background-image: url(img/hachures.png);'></td>"));                                                        }                                                      });                                                                                                    });                                                                 });                                            // affichage des disponibilitées pour les prise de RDV                                            if($ref == '0'){                                                $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td name="+$idthBis+" id='objBis' val="+$obj6+" who="+'vide'+" com="+$obj1+" pro="+$obj2+"></td>"));                                            }                                        }else{                                            $('#Provider'+$obj6+'-'+'Commercial'+$obj7).append($("<td title='Pause Déjeuner' id='obj' style='padding:0;background-color:#f1f3f6;vertical-align:middle;text-align:center'><i class='fa fa-cutlery' aria-hidden='true'></i></td>"));                                        }                                    });                                });                                                            }                            else {                                if(data.trim() == "Error1"){                                    //console.log("1");                                    toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                }else if(data.trim() == "Error2"){                                    //console.log("2");                                    alert("Le créneau horaire comporte une erreur.");                                }else if(data.trim() == "Error3"){                                    //console.log("3");                                    alert("Vous avez déja pris un Rendez-vous avec cette commission durant le même créneau horaire");                                }else if(data.trim() == "Error4"){                                    //console.log("4");                                    alert("Le créneau horaire comporte une erreur");                                    //toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                }else if(data.trim() == "Error5"){                                    //console.log("5");                                    alert("Le créneau horaire indiqué est placé sur une indisponibilitée de la commission");                                }else if(data.trim() == "Error6"){                                    /*console.log("6");                                    alert("Veuillez selectionner un Jour pour la prise de Rendez-vous");*/                                }else if(data.trim() == "Error7"){                                    //console.log("7");                                    alert("Veuillez selectionner un Fournisseur pour la prise de Rendez-vous");                                }else if(data.trim() == "Error8"){                                    //console.log("8");                                    alert("Le Rendez-vous ne peut pas être pris durant la pause Déjeuner");                                }else if(data.trim() == "Error9"){                                    //console.log("8");                                    alert("Le créneau horaire contient une erreur");                                }else{                                    //console.log("9");                                    toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                }                            }                        },                        'text'                    );                }else{                    TakePrisesDeRdv($jour_datetime, $debut, $nomCom, $nomProv, $idFournisseur);                }            }         });                    //console.log("test");        //$nb = 0;        $('#deleterdv').click(function(){                            $("#exampleModalCenter").modal('hide');                $debut_bis = $jour_datetime+' '+$debut;                $.post(                    './ajax/DeletePriseRdvStore.php',                    {                        start_datetime : $debut_bis,                        idFournisseur : $idFournisseur,                    },                    function(data) {                        //console.log(data);                        $donnees = data.trim().substring(0,5);                        if($donnees != 'Error') {                            tableAllIdFournisseurs = [];                            $tableAllIdFournisseursbis = [];                            if('.table-responsive:eq(0)' != undefined){                                $('.table-responsive:eq(0) tbody tr').each(function(index){                                    $tableAllIdFournisseursbis = [];                                    $tableAllIdFournisseursbis.push($(this).find('td:first').attr('id').substring(8)); //id fournisseur                                    $tableAllIdFournisseursbis.push($(this).find('td:eq(1)').attr('id').substring(10)); //id commercial                                    $tableAllIdFournisseursbis.push($(this).attr('id')); //id tr                                    $tableAllIdFournisseursbis.push($(this).find('td:first').html()); //nom fournisseur                                    $tableAllIdFournisseursbis.push($(this).find('td:eq(1)').html()); //nom commercial                                    $tableAllIdFournisseurs[index] = $tableAllIdFournisseursbis;                                });                            }                            var $thLunch = "";                            var $TESTarray = [];                            $('#tableRDV th').each(function(){                                if($(this).attr('name') == "thLunch"){                                    $thLunch = $(this).attr('id').substring(11,30);                                }                                if($(this).attr('id') != undefined){                                    $TESTarray.push($(this).attr('id'));                                }                            });                            LoadPrisesDeRdv($TESTarray, $tableAllIdFournisseurs, $thLunch);                                                    }                        else {                                                    }                    },                    'text'                );                $.post(                    './ajax/insertRepasForDelete.php',                    {                        JourSelect : $jour_datetime,                    },                    function(data) {                        //console.log(data);                        $donnees = data.trim().substring(0,5);                        //console.log($donnees);                        if($donnees != 'Error') {                            //console.log(data);                            $obj = data.trim();                            if($obj === "Success"){                                                                bootbox.confirm("Vous n'avez plus de RDV sur cette journée. Souhaitez-vous supprimer votre réservation de déjeuners pour cette journée ?", function(result) {                                    if(result === true) {                                                                                $.post(                                            './ajax/deleteRepas.php',                                            {                                                JourSelect : $jour_datetime,                                            },                                            function(data) {                                                //console.log(data);                                                $donnees = data.trim().substring(0,5);                                                if($donnees != 'Error') {                                                    if(data!=0){                                                        $('#warning-repas').empty();                                                    }                                                }else{                                                    toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                                }                                            },                                            'text'                                        );                                    }                                });                            }                        }                        else {                            toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                                                    }                    },                    'text'                );                $.post(                    './ajax/deleteRepasProvider.php',                    {                        JourSelect : $jour_datetime,                        idFournisseur : $idFournisseur,                    },                    function(data) {                        //console.log(data);                        $donnees = data.trim().substring(0,5);                        if($donnees === 'Error') {                                                        toastr.error('Erreur fatale. Contactez l\'administrateur.', 'Échec.');                        }                    },                    'text'                );                    });        //});    </script></body></html>