<?phprequire_once dirname(__FILE__) . '/view/errors.inc.php';require_once dirname(__FILE__) . '/services/AppServiceImpl.class.php';if (!isset($_SESSION)) session_start(); // Start session// Not connected as Admin ?if (!isset($_SESSION['adminConnected']) && empty($_SESSION['adminConnected'])) {    header('Location: ./disconnection.php'); // Redirection to Purchasing Fair list}header('content-type: text/html; charset=utf-8'); // Specifies to the server to return UTF-8 - put in prod$appService = AppServiceImpl::getInstance();if (isset($_POST) && !empty($_POST)) { // Form validated    $pfName = $_POST['pfName'];    $pfColor = $_POST['pfColor'];    $pfDayRdv = $_POST['pfDayRdv'];    // Tip - Creating a daterange 'YYYY-MM-DD HH:MM:SS - YYY-MM-DD HH:MM:SS' to use the $appservice function    $dateRange = $appService->convertDateRangeToMySqlFormat($_POST['pfStartDateTime'] . ' - ' . $_POST['pfEndDateTime']);    $pfRegistrationClosingDateMagasinFormatted = DateTime::createFromFormat('d/m/Y H:i:s', $_POST['pfRegistrationClosingDateMagasin'])->format('Y-m-d H:i:s');    $pfRegistrationClosingDateFournisseurFormatted = DateTime::createFromFormat('d/m/Y H:i:s', $_POST['pfRegistrationClosingDateFournisseur'])->format('Y-m-d H:i:s');    $pfStartDateTime = $dateRange['startDatetime'];    $pfEndDateTime = $dateRange['endDatetime'];    $pfLunchBreak = $_POST['pfLunchBreak']; // In database, insert HH:MM:00 with :00 added automatically    $pfTypeOfPf = $_POST['pfTypeOfPf'];    $createdPurchasingFair = $appService->createPurchasingFair($pfName, $pfColor, $pfDayRdv, $pfStartDateTime, $pfEndDateTime, $pfLunchBreak, $pfTypeOfPf, $pfRegistrationClosingDateMagasinFormatted, $pfRegistrationClosingDateFournisseurFormatted);    $count = $appService->savePurchasingFair($createdPurchasingFair);    $successInsert = ($count) ? 1 : 0;}?><!DOCTYPE html><html lang="fr"><head>    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="theme-color" content="#0b70b5"><!-- Mobile browser Tab Color -->    <title>PFManagement | Saisie salons</title>    <!-- Favicon -->    <?php require_once dirname(__FILE__) . '/view/favicon.inc.php'; ?>    <!-- Bootstrap -->    <link href="css/bootstrap.min.css" rel="stylesheet">    <!-- boostrap datapicker -->    <link href="css/plugins/bootstrap-datapickers/bootstrap-datapicker3.min.css" rel="stylesheet">    <!-- Font Awesome -->    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">    <!-- Hover -->    <link href="css/plugins/hover.css/hover-min.css" rel="stylesheet">    <!-- Toastr style -->    <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">    <!-- Color picker -->    <link href="css/plugins/colorpicker/bootstrap-colorpicker.min.css" rel="stylesheet">    <!-- Daterange picker -->    <link href="css/plugins/daterangepicker/daterangepicker.css" rel="stylesheet">    <!-- DateMultiPick -->    <link href="css/plugins/dateMultiPick/multiDate.css" rel="stylesheet">    <!-- Clockpicker -->    <link href="css/plugins/clockpicker/clockpicker.css" rel="stylesheet">    <!-- iCheck -->    <link href="css/plugins/iCheck/custom.css" rel="stylesheet">    <!-- Animate -->    <link href="css/animate.css" rel="stylesheet">    <!-- Global -->    <link href="css/style.css" rel="stylesheet">    <!-- Custom style -->    <style>        .mydaterangepicker, .Dates {            cursor: pointer;        }        .ibox-title {            border-top: 2px solid #0b70b5;        }        .ibox-title h5 {            color: #0b70b5;        }        #submitButton {            background-color: #0b70b5;            color: #ffffff;            border: 1px solid #000000;        }        #submitButton:hover {            background-color: #ed8b18;            color: #ffffff;            border: 1px solid #000000;        }    </style></head><body><div id="wrapper">    <?php require_once dirname(__FILE__) . '/view/menu.global.inc.php'; ?>    <div id="page-wrapper" class="gray-bg">        <div class="row border-bottom">            <nav class="navbar navbar-static-top  " role="navigation" style="margin-bottom: 0">                <div class="navbar-header">                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i>                    </a>                </div>                <ul class="nav navbar-top-links navbar-right">                    <li>                        <span class="m-r-sm text-muted welcome-message">Saisie salons</span>                    </li>                    <li>                        <a href="./disconnection.php">                            <i class="fa fa-sign-out"></i> Quitter                        </a>                    </li>                </ul>            </nav>        </div>        <div class="row wrapper border-bottom white-bg page-heading">            <div class="col-sm-4">                <h2><i class="fa fa-pencil" aria-hidden="true"></i> Saisie des RDV GT</h2>                <ol class="breadcrumb">                    <li>                        <a href="./index_store.php">Accueil</a>                    </li>                    <li class="active">                        <strong>Saisie RDV GT</strong>                    </li>                </ol>            </div>        </div>        <div class="wrapper wrapper-content">            <div class="row">                <div class="col-lg-offset-3 col-lg-6">                    <div class="ibox float-e-margins animated fadeInDown">                        <div class="ibox-title">                            <h5>Formulaire</h5>                        </div>                        <div class="ibox-content">                            <div class="row">                                <form class="col-lg-12 m-t" role="form" action="#" method="POST">                                    <div class="form-group"><label class="col-sm-12 control-label"                                                                   style="padding-left:0;">Type de RDV GT</label>                                        <div class="col-sm-12 m-b-sm" style="padding-left:0;">                                            <div class="i-checks"><label> <input type="radio" checked="" value="1"                                                                                 name="pfTypeOfPf"> <i></i> NEGO                                                    <!--(sélectionné par défaut)--></label></div>                                            <div class="i-checks" style="display:none"><label> <input type="radio"                                                                                                      value="2"                                                                                                      name="pfTypeOfPf"                                                                                                      disabled="disabled">                                                    <i></i> Autre </label></div>                                        </div>                                    </div>                                    <div class="hr-line-dashed"></div>                                    <div class="form-group">                                        <label>Nom du RDV GT</label>                                        <div class="input-group m-b">                                            <span class="input-group-addon"><i class="fa fa-tag" aria-hidden="true"></i></span>                                            <input type="text" class="form-control" id="pfName" name="pfName" value=""                                                   maxlength="50" required="">                                        </div>                                    </div>                                    <div class="form-group">                                        <label>Couleur de fond (affichée dans la liste des RDV GT)</label>                                        <div class="input-group m-b">                                            <span class="input-group-addon"><i class="fa fa-eyedropper"                                                                               aria-hidden="true"></i></span>                                            <input type="text" class="form-control" id="pfColor" name="pfColor"                                                   value="#0b70b5" required="">                                        </div>                                    </div>                                    <div class="form-group">                                        <label>Jours de participations</label>                                        <div class="form-group input-group m-b date" id="datepicker">                                                <span class="input-group-addon"><i                                                            class="glyphicon glyphicon-calendar"></i><span                                                            class="count"></span></span>                                            <input type="text" class="form-control Dates" id="pfDayRdv" name="pfDayRdv"                                                   placeholder="Choisissez les jours qui vous conviennent" required=""/>                                            <i class="form-group__bar"></i>                                        </div>                                    </div>                                    <div class="form-group">                                        <label>Date et heure de début</label>                                        <div class="input-group m-b">                                            <span class="input-group-addon"><i class="fa fa-calendar-plus-o"                                                                               aria-hidden="true"></i></span>                                            <div class="form-group">                                                <input id="pfStartDateTime" name="pfStartDateTime" type="text"                                                       class="form-control mydaterangepicker"                                                       placeholder="Cliquer ici pour ajouter la date de début"                                                       required="">                                                <i class="form-group__bar"></i>                                            </div>                                        </div>                                    </div>                                    <div class="form-group">                                        <label>Date et heure de fin</label>                                        <div class="input-group m-b">                                            <span class="input-group-addon"><i class="fa fa-calendar-times-o"                                                                               aria-hidden="true"></i></span>                                            <input id="pfEndDateTime" name="pfEndDateTime" type="text"                                                   class="form-control mydaterangepicker"                                                   placeholder="Cliquer ici pour ajouter la date de fin" required="">                                        </div>                                    </div>                                    <div class="form-group">                                        <label>Date d'ouverture des inscriptions Fournisseur</label>                                        <div class="input-group m-b">                                            <span class="input-group-addon"><i class="fa fa-ban" aria-hidden="true"></i></span>                                            <input id="pfRegistrationClosingDateFournisseur"                                                   name="pfRegistrationClosingDateFournisseur" type="text"                                                   class="form-control mydaterangepicker"                                                   placeholder="Cliquer ici pour ajouter la date de clôture des enregistrements"                                                   required="">                                        </div>                                    </div>                                    <div class="form-group">                                        <label>Date de clôture des inscriptions Fournisseur</label>                                        <div class="input-group m-b">                                            <span class="input-group-addon"><i class="fa fa-ban" aria-hidden="true"></i></span>                                            <input id="pfRegistrationClosingDateMagasin"                                                   name="pfRegistrationClosingDateMagasin" type="text"                                                   class="form-control mydaterangepicker"                                                   placeholder="Cliquer ici pour ajouter la date de clôture des enregistrements"                                                   required="">                                        </div>                                    </div>                                    <div class="form-group">                                        <label>Heure de la pause-déjeuner</label>                                        <div class="input-group m-b clockpicker" data-placement="top" data-align="left"                                             data-donetext="Valider" data-autoclose="false">                                            <span class="input-group-addon"><i class="fa fa-cutlery"></i></span>                                            <input id="pfLunchBreak" name="pfLunchBreak" type="text"                                                   class="form-control" value="12:00" required="">                                        </div>                                    </div>                                    <button type="submit" id="submitButton"                                            class="btn block full-width m-t m-b hvr-icon-bounce">Enregistrer                                    </button>                                </form>                            </div>                            <div class="col-lg-12">&nbsp;</div>                        </div>                    </div>                </div>            </div><!-- ./row -->        </div>        <div class="footer">            <div class="pull-right">                <strong><i class="fa fa-copyright" aria-hidden="true"></i></strong> E.Leclerc | SCA                Ouest <?php echo date('Y'); ?>            </div>            <div>                <strong>PFManagement</strong>            </div>        </div>    </div></div><!-- Mainly scripts --><script src="js/jquery-3.1.1.min.js"></script><script src="js/bootstrap.min.js"></script><script src="js/plugins/bootstrap-datapicker/bootstrap-datapicker.min.js"></script><script src="js/plugins/metisMenu/jquery.metisMenu.js"></script><script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script><!-- Color picker --><script src="js/plugins/colorpicker/bootstrap-colorpicker.min.js"></script><!-- Daterange picker --><script src="js/plugins/daterangepicker/moment.min.js"></script><script src="js/plugins/daterangepicker/daterangepicker.js"></script><!-- date multi picker --><script src="js/plugins/datemulti/datemulti.js"></script><!-- Clock picker --><script src="js/plugins/clockpicker/clockpicker.js"></script><!-- Custom and plugin javascript --><script src="js/inspinia.js"></script><script src="js/plugins/pace/pace.min.js"></script><!-- Toastr script --><script src="js/plugins/toastr/toastr.min.js"></script><!-- iCheck --><script src="js/plugins/iCheck/icheck.min.js"></script><script>    $("#pfColor").colorpicker();    $('.clockpicker').clockpicker();    $('#pfDayRdv').datepicker();    $("#pfStartDateTime").daterangepicker({        "showWeekNumbers": true,        "timePicker": true,        "timePicker24Hour": true,        "locale": {            "format": "DD/MM/YYYY HH:mm",            "separator": " - ",            "applyLabel": "<i class=\"fa fa-check\" aria-hidden=\"true\"></i>",            "cancelLabel": "<i class=\"fa fa-times\" aria-hidden=\"true\"></i>",            "fromLabel": "From",            "toLabel": "To",            "customRangeLabel": "Custom",            "weekLabel": "S",            "daysOfWeek": [                "Di",                "Lu",                "Ma",                "Me",                "Je",                "Ve",                "Sa"            ],            "monthNames": [                "Janvier",                "Février",                "Mars",                "Avril",                "Mai",                "Juin",                "Juillet",                "Août",                "Septembre",                "Octobre",                "Novembre",                "Décembre"            ],            "firstDay": 1        },        "showCustomRangeLabel": false,        "autoUpdateInput": false,        "singleDatePicker": true,        "startDate": "<?php echo date('d'); ?>/<?php echo date('m'); ?>/<?php echo date('Y'); ?> 08:00",//            "endDate": "23/08/2017 23:59",        "applyClass": "btn-info",        "cancelClass": "btn-danger"    });    $("#pfStartDateTime").on('apply.daterangepicker', function (ev, picker) {        $("#pfStartDateTime").val(picker.startDate.format("DD/MM/YYYY HH:mm:00"));    });    $("#pfStartDateTime").on('cancel.daterangepicker', function (ev, picker) {        $("#pfStartDateTime").val("");    });    $("#pfEndDateTime").daterangepicker({        "showWeekNumbers": true,        "timePicker": true,        "timePicker24Hour": true,        "locale": {            "format": "DD/MM/YYYY HH:mm",            "separator": " - ",            "applyLabel": "<i class=\"fa fa-check\" aria-hidden=\"true\"></i>",            "cancelLabel": "<i class=\"fa fa-times\" aria-hidden=\"true\"></i>",            "fromLabel": "From",            "toLabel": "To",            "customRangeLabel": "Custom",            "weekLabel": "S",            "daysOfWeek": [                "Di",                "Lu",                "Ma",                "Me",                "Je",                "Ve",                "Sa"            ],            "monthNames": [                "Janvier",                "Février",                "Mars",                "Avril",                "Mai",                "Juin",                "Juillet",                "Août",                "Septembre",                "Octobre",                "Novembre",                "Décembre"            ],            "firstDay": 1        },        "showCustomRangeLabel": false,        "autoUpdateInput": false,        "singleDatePicker": true,        "startDate": "<?php echo date('d'); ?>/<?php echo date('m'); ?>/<?php echo date('Y'); ?> 19:00",//            "endDate": "23/08/2017 23:59",        "applyClass": "btn-info",        "cancelClass": "btn-danger"    });    $("#pfEndDateTime").on('apply.daterangepicker', function (ev, picker) {        $("#pfEndDateTime").val(picker.startDate.format("DD/MM/YYYY HH:mm:00"));    });    $("#pfEndDateTime").on('cancel.daterangepicker', function (ev, picker) {        $("#pfEndDateTime").val("");    });    $("#pfRegistrationClosingDateFournisseur").daterangepicker({        "showWeekNumbers": true,        "timePicker": true,        "timePicker24Hour": true,        "locale": {            "format": "DD/MM/YYYY HH:mm",            "separator": " - ",            "applyLabel": "<i class=\"fa fa-check\" aria-hidden=\"true\"></i>",            "cancelLabel": "<i class=\"fa fa-times\" aria-hidden=\"true\"></i>",            "fromLabel": "From",            "toLabel": "To",            "customRangeLabel": "Custom",            "weekLabel": "S",            "daysOfWeek": [                "Di",                "Lu",                "Ma",                "Me",                "Je",                "Ve",                "Sa"            ],            "monthNames": [                "Janvier",                "Février",                "Mars",                "Avril",                "Mai",                "Juin",                "Juillet",                "Août",                "Septembre",                "Octobre",                "Novembre",                "Décembre"            ],            "firstDay": 1        },        "showCustomRangeLabel": false,        "autoUpdateInput": false,        "singleDatePicker": true,        "startDate": "<?php echo date('d'); ?>/<?php echo date('m'); ?>/<?php echo date('Y'); ?> 06:00",//            "endDate": "23/08/2017 23:59",        "drops": "up",        "applyClass": "btn-info",        "cancelClass": "btn-danger"    });    $("#pfRegistrationClosingDateFournisseur").on('apply.daterangepicker', function (ev, picker) {        $("#pfRegistrationClosingDateFournisseur").val(picker.startDate.format("DD/MM/YYYY HH:mm:00"));    });    $("#pfRegistrationClosingDateFournisseur").on('cancel.daterangepicker', function (ev, picker) {        $("#pfRegistrationClosingDateFournisseur").val("");    });    $("#pfRegistrationClosingDateMagasin").daterangepicker({        "showWeekNumbers": true,        "timePicker": true,        "timePicker24Hour": true,        "locale": {            "format": "DD/MM/YYYY HH:mm",            "separator": " - ",            "applyLabel": "<i class=\"fa fa-check\" aria-hidden=\"true\"></i>",            "cancelLabel": "<i class=\"fa fa-times\" aria-hidden=\"true\"></i>",            "fromLabel": "From",            "toLabel": "To",            "customRangeLabel": "Custom",            "weekLabel": "S",            "daysOfWeek": [                "Di",                "Lu",                "Ma",                "Me",                "Je",                "Ve",                "Sa"            ],            "monthNames": [                "Janvier",                "Février",                "Mars",                "Avril",                "Mai",                "Juin",                "Juillet",                "Août",                "Septembre",                "Octobre",                "Novembre",                "Décembre"            ],            "firstDay": 1        },        "showCustomRangeLabel": false,        "autoUpdateInput": false,        "singleDatePicker": true,        "startDate": "<?php echo date('d'); ?>/<?php echo date('m'); ?>/<?php echo date('Y'); ?> 06:00",//            "endDate": "23/08/2017 23:59",        "drops": "up",        "applyClass": "btn-info",        "cancelClass": "btn-danger"    });    $("#pfRegistrationClosingDateMagasin").on('apply.daterangepicker', function (ev, picker) {        $("#pfRegistrationClosingDateMagasin").val(picker.startDate.format("DD/MM/YYYY HH:mm:00"));    });    $("#pfRegistrationClosingDateMagasin").on('cancel.daterangepicker', function (ev, picker) {        $("#pfRegistrationClosingDateMagasin").val("");    });    // Success OR Error message    <?php    if(isset($_POST) && !empty($_POST) && !empty($successInsert)) { ?>    // Display a success toast, with a title    toastr.success('Enregistrement effectué.', 'Succès.');    <?php } elseif(isset($_POST) && !empty($_POST) && empty($successInsert)) { ?>    toastr.error('Echec de l\'enregistrement.', 'Échec.');    <?php } ?>    <!-- icheck class -->    $(document).ready(function () {        $('.i-checks').iCheck({            checkboxClass: 'icheckbox_square-green',            radioClass: 'iradio_square-green',        });    });</script></body></html>