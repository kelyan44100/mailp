<?phprequire_once dirname ( __FILE__ ) . '/view/errors.inc.php';require_once dirname ( __FILE__ ) . '/services/AppServiceImpl.class.php';if(!isset($_SESSION)) session_start(); // Start session// Not connected as Admin ?if(!isset($_SESSION['adminConnected']) && empty($_SESSION['adminConnected'])) {    header('Location: ./disconnection.php'); // Redirection to Purchasing Fair list}header( 'content-type: text/html; charset=utf-8' ); // Specifies to the server to return UTF-8 - put in prod$appService = AppServiceImpl::getInstance();$arraySalespersons = $appService->findAllParticipantsAsSalespersons();date_default_timezone_set('Europe/Paris');$arrayDays = array('DIMANCHE','LUNDI','MARDI','MERCREDI','JEUDI','VENDREDI','SAMEDI');$pfConcerned = $_SESSION['purchasingFairConcerned'];$startDatetime = DateTime::createFromFormat('Y-m-d H:i:s', $pfConcerned->getStartDatetime());$endDatetime   = DateTime::createFromFormat('Y-m-d H:i:s', $pfConcerned->getEndDatetime());$counterArrayPlanningDays= 0;while($startDatetime < $endDatetime) {         if($arrayDays[$startDatetime->format('w')] != 'SAMEDI' && $arrayDays[$startDatetime->format('w')] != 'DIMANCHE') {                // Clone because variables hold references to objects, not the objects themselves.         // So assignment just gets you more variables pointing to the same object, not multiple copies of the object.        $startAt = clone $startDatetime;        $endAt   = clone $startDatetime;        $endAt->setTime(19,0,0);        $arrayPlanningDays[] = new PlanningDay(++$counterArrayPlanningDays, $startAt, $endAt, array(), array());    }    // http://php.net/manual/fr/datetime.add.php    // http://php.net/manual/fr/dateinterval.construct.php    $startDatetime->add( new DateInterval('P1D') ); // P = period, D = Day}function dateDiff($date1, $date2){ //renvoie la différence entre deux dates en minutes    $diff = abs($date1 - $date2); // abs pour avoir la valeur absolute, ainsi éviter d'avoir une différence négative    $retour = array();     $tmp = $diff;     $tmp = floor( ($tmp - ($tmp % 60)) /60 );    $retour['minute'] = $tmp /*% 60*/;     /*$tmp = floor( ($tmp - $retour['minute'])/60 );    $retour['hour'] = $tmp;*/     return $retour;}$labels = array();$labelsBis = array();$DetailRdvsForOneDay = array();$DetailRdvsForOneDayStore = array();$data = array();$countDay = count($arrayPlanningDays);$colors = $appService->generateNColors($countDay);//print_r($colors);$sommeHeure = 0;foreach ($arrayPlanningDays as $key => $value) {    $labels[] = $appService->nom_jour($value->getStartDatetime()->format('Y-m-d'));    $labelsBis[] = $value->getStartDatetime()->format('Y-m-d');    $rdvForOneDay = $appService->findPriseRdvByTwo($value->getStartDatetime()->format('Y-m-d'), $_SESSION['purchasingFairConcerned']->getIdPurchasingFair());    if($rdvForOneDay != null){        $totalHeure = array();        $totalHeure['minute'] = "";        $totalHeure['hour'] = "";        foreach ($rdvForOneDay as $key2 => $value2) {            //print_r($value2);            $h1=strtotime(substr($value2->getStartDatetime(), 11));            $h2=strtotime(substr($value2->getEndDatetime(), 11));            //print_r( dateDiff($h1, $h2) );            $test = dateDiff($h1, $h2);            $totalHeure['minute'] = $totalHeure['minute'] + $test['minute'];            //$totalHeure['hour'] = $totalHeure['hour'] + $test['hour'];            $resultMinuteTer = $test['minute'] % 60;            $resultHeureTer = ($test['minute'] - $resultMinuteTer) / 60;            $creneauHoraire = $resultHeureTer.".".$resultMinuteTer;            if($DetailRdvsForOneDay[$key] == null){                $DetailRdvsForOneDay[$key][] = [                    "0" => $appService->findOneEnterprise($value2->getIdFournisseur())->getName(),                    "1" => $creneauHoraire,                ];            }else{                $tmp2 = "0";                                foreach ($DetailRdvsForOneDay[$key] as $key3 => $value3) {                    if($value3[0] == $appService->findOneEnterprise($value2->getIdFournisseur())->getName()){                        $tmp2 = "1";                        $DetailRdvsForOneDay[$key][$key3] = [                            "0" => $value3[0],                            "1" => $value3[1] + $creneauHoraire,                        ];                    }                }                if($tmp2 == "0"){                    $DetailRdvsForOneDay[$key][] = [                        "0" => $appService->findOneEnterprise($value2->getIdFournisseur())->getName(),                        "1" => $creneauHoraire,                    ];                }            }                        if($DetailRdvsForOneDayStore[$key] == null){                $DetailRdvsForOneDayStore[$key][] = [                    "0" => $appService->findOneEnterprise($value2->getIdStore())->getName(),                    "1" => $creneauHoraire,                ];            }else{                $tmp3 = "0";                                foreach ($DetailRdvsForOneDayStore[$key] as $key4 => $value4) {                    if($value4[0] == $appService->findOneEnterprise($value2->getIdStore())->getName()){                        $tmp3 = "1";                        $DetailRdvsForOneDayStore[$key][$key4] = [                            "0" => $value4[0],                            "1" => $value4[1] + $creneauHoraire,                        ];                    }                }                if($tmp3 == "0"){                    $DetailRdvsForOneDayStore[$key][] = [                        "0" => $appService->findOneEnterprise($value2->getIdStore())->getName(),                        "1" => $creneauHoraire,                    ];                }            }                    }        $resultMinute = $totalHeure['minute'] % 60;        $resultHeure = ($totalHeure['minute'] - $resultMinute) / 60;        $data[] = $resultHeure.".".$resultMinute;        $sommeHeure = $sommeHeure + $totalHeure['minute'];        /*print_r($resultHeure);        print_r("_____");*/        //print les heures et minutes dans le graph    }else{        $data[] = 0;        $DetailRdvsForOneDay[$key] = 0;        $DetailRdvsForOneDayStore[$key] = 0;    }    }//print_r($DetailRdvsForOneDayStore);//print_r($DetailRdvsForOneDay);$resultMinuteBis = $sommeHeure % 60;$resultHeureBis = ($sommeHeure - $resultMinuteBis) / 60;//print_r($resultHeureBis);$stringLabels = "";foreach ($labels as $key => $value) {    if($key == 0){        $stringLabels = '"'.$value.'"';    }else{        $stringLabels = $stringLabels . ',"'.$value.'"';    }    }//print_r($stringLabels);$stringcolors = "";foreach ($colors as $key => $value) {    if($key == 0){        $stringcolors = '"'.$value.'"';    }else{        $stringcolors = $stringcolors . ',"'.$value.'"';    }    }//print_r($stringcolors);$stringData = "";foreach ($data as $key => $value) {    if($key == 0){        $stringData = $value;    }else{        $stringData = $stringData . ','.$value;    }    }$arrayStoresInscrit = $appService->findAllEnterprisesAsStoresPfBis($_SESSION['purchasingFairConcerned']->getIdPurchasingFair());;$arrayStoresPresent = $appService->findAllEnterprisesAsStores();$arrayNameStoresInscrit = array();if($arrayStoresInscrit != null){    foreach ($arrayStoresInscrit as $key => $value) {        $arrayNameStoresInscrit[] = $appService->findOneEnterprise($value)->getName();    }}$arrayNameStoresPresent = array();if($arrayStoresPresent != null){    foreach ($arrayStoresPresent as $key => $value) {        $arrayNameStoresPresent[] = $value->getName();    }}$result = array_diff($arrayNameStoresPresent, $arrayNameStoresInscrit);$countResult = count($result);//print_r($arrayNameStoresInscrit);?><!DOCTYPE html><html lang="fr"><head>    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="theme-color" content="#0b70b5"><!-- Mobile browser Tab Color -->    <title>PFManagement | Liste Commerciaux</title>	    <!-- Favicon -->    <?php require_once dirname ( __FILE__ ) . '/view/favicon.inc.php'; ?>    <!-- Bootstrap -->    <link href="css/bootstrap.min.css" rel="stylesheet">	    <!-- Font Awesome -->    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">        <!-- DataTables -->    <link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">	    <!-- Hover -->    <link href="css/plugins/hover.css/hover-min.css" rel="stylesheet">        <!-- Toastr style -->    <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">    <!-- Animate -->    <link href="css/animate.css" rel="stylesheet">	    <!-- Global -->    <link href="css/style.css" rel="stylesheet">        <!-- Custom style -->    <style>    /* Widget */    .widget { color:#ffffff;border:1px solid #ffffff; }    /* ibox */    .ibox-title { border-top:2px solid #0b70b5; }    .ibox-title h5 { color:#0b70b5; }    /* Replace the icon of the button */    .hvr-icon-wobble-horizontal:before { content: "\f12d"; }    /* Color orange E.Leclerc */    .colorOrangeLeclerc { color:#ed8b18; }    .colorBlueLeclerc { color:#0b70b5; }    /* Spinenr color */    .sk-spinner-wave div, .sk-spinner-three-bounce div{ background-color:#0b70b5; }    /* Update/Remove icons */    .actionEdit, .actionDelete { cursor:pointer }    .actionEdit { color:#0b70b5; }    .actionDelete { color:#ed8b18; }    </style></head><body>    <div id="wrapper">        <!-- Modal -->        <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">          <div class="modal-dialog" role="document">            <div class="modal-content">                <div class="modal-header">                    <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">                      <span aria-hidden="true">&times;</span>                    </button>                </div>                <div data-toggle="buttons" style="text-align: center; display: none" id="divBtsRadio">                  <input type="radio" id="customRadioInline2" name="customRadioInline1" class="custom-control-input" value="F">                  <label class="custom-control-label" for="customRadioInline2" style="margin-right: 10px">Côté Fournisseurs</label>                  <input type="radio" id="customRadioInline1" name="customRadioInline1" class="custom-control-input" value="M">                  <label class="custom-control-label" for="customRadioInline1">Côté Fournisseurss</label>                </div>              <div class="modal-body">                              </div>              <div style="display: none; margin-bottom: 40px;" class="modal-chart">                                </div>            </div>          </div>        </div>        <?php require_once dirname ( __FILE__ ) . '/view/menu.global.inc.php'; ?>        <div id="page-wrapper" class="gray-bg">        <div class="row border-bottom">        <nav class="navbar navbar-static-top  " role="navigation" style="margin-bottom: 0">        <div class="navbar-header">            <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>        </div>            <ul class="nav navbar-top-links navbar-right">                <li>                    <span class="m-r-sm text-muted welcome-message">Tableau de bord</span>                </li>                <li>                    <a href="./disconnection.php">                        <i class="fa fa-sign-out"></i> Quitter                    </a>                </li>            </ul>        </nav>        </div>            <div class="row wrapper border-bottom white-bg page-heading">                <div class="col-lg-9">                    <h2><i class="fa fa-table" aria-hidden="true"></i> Tableau de bord </h2>                    <ol class="breadcrumb">                        <li class="active">                            <strong>Administration/Tableau de bord</strong>                        </li>                    </ol>                </div>                <div class="col-lg-3">                <?php if( isset($_SESSION['enterpriseConcerned']) && !empty($_SESSION['enterpriseConcerned']) && !isset($_SESSION['adminConnected']) && empty($_SESSION['adminConnected']) ) { ?>                <h2 class="text-center">Vous avez sélectionné le <?php echo $_SESSION['enterpriseConcerned']->getOneProfile()->getName() ?></h2>                <h2 class="colorOrangeLeclerc text-center"><em><?php echo $_SESSION['enterpriseConcerned']->getName(); ?></em></h2>                <?php } elseif( isset($_SESSION['adminConnected']) && !empty($_SESSION['adminConnected']) && isset($_SESSION['purchasingFairConcerned']) && !empty($_SESSION['purchasingFairConcerned'])) { ?>                <?php require_once dirname ( __FILE__ ) . '/view/widget_pf_info.inc.php'; ?>                <?php } elseif( isset($_SESSION['adminConnected']) && !empty($_SESSION['adminConnected']) && !isset($_SESSION['purchasingFairConcerned']) && empty($_SESSION['purchasingFairConcerned'])) { ?>                <h2 class="text-center">Vous n'avez pas sélectionné de salon</h2>                <?php } ?>                </div>            </div>            <div class="wrapper wrapper-content">                                <div class="row" ><!--                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 animated zoomIn">                        <div class="ibox">                            <div class="ibox-content">                                <h5 class="text-center" style="color:#0b70b5">Nombre de fournisseurs inscrits</h5>                                <div class="text-center">                                    <canvas id="flot-pie-chart"></canvas>                                </div>                            </div>                        </div>                    </div>-->                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 animated zoomIn">                        <div class="ibox">                            <div class="ibox-content">                                <h5 class="text-center" style="color:#0b70b5">Nombre de Fournisseurs inscrits</h5>                                <div class="text-center">                                    <canvas id="flot-pie-chart-store"></canvas>                                </div>                            </div>                        </div>                    </div><!--                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 animated zoomIn">                        <div class="ibox" >                            <div class="ibox-content">                                <h5 class="text-center" style="color:#0b70b5">Nombre d'heures de RDV par jour de salon ( Total Heures : <?php echo $resultHeureBis.".".$resultMinuteBis; ?> )</h5>                                <div class="text-center">                                    <canvas id="bar-chart" ></canvas>                                </div>                            </div>                        </div>                    </div>                   -->                                    </div><!-- ./row -->                            </div>            <div class="footer">                <div class="pull-right">                    <strong><i class="fa fa-copyright" aria-hidden="true"></i></strong> E.Leclerc | SCA Ouest <?php echo date('Y'); ?>                </div>                <div>                    <strong>PFManagement</strong>                </div>            </div>        </div>        </div>    <!-- Mainly scripts -->    <script src="js/Charts/Chart.min.js"></script>    <script src="js/canvas/canvasjs.min.js"></script>    <script src="js/jquery-3.1.1.min.js"></script>    <script src="js/bootstrap.min.js"></script>    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>    <script src="js/plugins/flot/jquery.flot.js"></script>    <script src="js/plugins/flot/jquery.flot.tooltip.min.js"></script>    <script src="js/plugins/flot/jquery.flot.resize.js"></script>    <script src="js/plugins/flot/jquery.flot.pie.js"></script>    <script src="js/plugins/flot/jquery.flot.time.js"></script>    <!-- Custom and plugin javascript -->    <script src="js/inspinia.js"></script>    <script src="js/plugins/pace/pace.min.js"></script>    <!-- DataTables -->    <script src="js/plugins/dataTables/datatables.min.js"></script>        <!-- Sparkline -->    <script src="js/plugins/sparkline/jquery.sparkline.min.js"></script>    <!-- Custom and plugin javascript -->    <script src="js/inspinia.js"></script>    <script src="js/plugins/pace/pace.min.js"></script>        <!-- Toastr script -->    <script src="js/plugins/toastr/toastr.min.js"></script>    <!-- Custom and plugin javascript -->	    <!-- Custom script -->    <script>    <?php     $arrayProviderPresent = $appService->findAllProviderPresentForOnePurchasingFair($_SESSION['purchasingFairConcerned']->getIdPurchasingFair());     $arrayProviderInscrit = $appService->findDistinctProviders($_SESSION['purchasingFairConcerned']->getIdPurchasingFair());    $colorsPie = $appService->generateNColors(1000);    ?>    $countArrayStoresPresent = <?php echo json_encode(count($arrayStoresPresent)); ?>;    $countArrayStoresInscrit = <?php echo json_encode(count($arrayStoresInscrit)); ?>;    $arrayNameStoresInscrit = <?php echo json_encode($arrayNameStoresInscrit); ?>;    $arrayStoresNonInscrit = <?php echo json_encode($result); ?>;    $JQstringColors = <?php echo json_encode($colorsPie); ?>;    //console.log($JQstringColors);    // START Pie Chart Stores    Chart.defaults.global.legend.position = 'right';    var NewPieChartStore = new Chart(document.getElementById("flot-pie-chart-store"), {        type: 'pie',        data: {          labels: ["Fournisseurs inscrits", "Fournisseurs non inscrits"],          datasets: [            {              label: "",              backgroundColor: ['<?php echo $colorsPie[30]; ?>', '<?php echo $colorsPie[70]; ?>'],              data: [$countArrayStoresInscrit, ($countArrayStoresPresent - $countArrayStoresInscrit)]            }          ]        },        options: {          legend: { display: true },          title: {            display: true,            text: ''          }        }    });    $('#flot-pie-chart-store').bind('click', function(ev) {        var activePointsStore = NewPieChartStore.getElementsAtEvent(ev);        $indexClickedStore = activePointsStore[0]["_index"];        $("#exampleModalLong").modal('show');        $('.modal-body').empty();        $('.modal-chart').hide();        $('.modal-chart').css(["display", "none"]);        $('#divBtsRadio').hide();        $('#divBtsRadio').css(["display", "none"]);        if($indexClickedStore == 0){            $('#exampleModalLongTitle').text("Detail Fournisseurs inscrits");            if($arrayNameStoresInscrit != null){                $.each( $arrayNameStoresInscrit, function( key, st ) {                    $('.modal-body').append("<span class='glyphicon glyphicon-hand-right'></span>&nbsp"+st+"<br>");                });            }else{                $('.modal-body').append("AUCUN");            }                                }else{            $('#exampleModalLongTitle').text("Detail Fournisseurs non inscrits");            if($arrayStoresNonInscrit != null){                $.each( $arrayStoresNonInscrit, function( key, value2 ) {                  $('.modal-body').append("<span class='glyphicon glyphicon-hand-right'></span>&nbsp"+value2+"<br>");                });            }else{                $('.modal-body').append("AUCUN");            }                    }    });// END Pie Chart Stores// START Pie Chart Providers    Chart.defaults.global.legend.position = 'right';    var NewPieChart = new Chart(document.getElementById("flot-pie-chart"), {        type: 'pie',        data: {          labels: ["Fournisseurs inscrits", "Fournisseurs non inscrits"],          datasets: [            {              label: "",              backgroundColor: ['<?php echo $colorsPie[50]; ?>', '<?php echo $colorsPie[90]; ?>'],              data: [<?php echo count($arrayProviderPresent) - (count($arrayProviderPresent) - count($arrayProviderInscrit)); ?>, <?php echo  count($arrayProviderPresent) - count($arrayProviderInscrit); ?>]            }          ]        },        options: {          legend: { display: true },          title: {            display: true,            text: ''          }        }    });    <?php    $arrayNameProviderInscrit = array();    foreach ($arrayProviderInscrit as $key => $value) {        $arrayNameProviderInscrit[] = $appService->findOneEnterprise($value[0])->getName();        $listSP = $appService->findAssignmentSpStore($value[0], $_SESSION['purchasingFairConcerned']->getIdPurchasingFair());        $arraySP = array();        foreach ($listSP as $key => $value1) {            $arraySP[] = $appService->findOneParticipant($value1)->getSurname()." ".$appService->findOneParticipant($value1)->getName();        }        $arrayNameProviderInscritBis[] = [            "0" => $appService->findOneEnterprise($value[0])->getName(),            "1" => $arraySP,        ];        //print_r($value[0]);    }    $arrayNameProviderPresent = array();    foreach ($arrayProviderPresent as $key => $value) {        $arrayNameProviderPresent[] = $value->getOneProvider()->getName();    }    $result = array_diff($arrayNameProviderPresent, $arrayNameProviderInscrit);    ?>    $('#flot-pie-chart').bind('click', function(ev) {        $refClick = "1";        var activePoints = NewPieChart.getElementsAtEvent(ev);        $indexClicked = activePoints[0]["_index"];        $("#exampleModalLong").modal('show');        var tab = <?php echo json_encode($arrayNameProviderInscritBis); ?>;        tab2 = <?php echo json_encode($result); ?>;        $('.modal-body').empty();        $('.modal-chart').hide();        $('.modal-chart').css(["display", "none"]);        $('#divBtsRadio').hide();        $('#divBtsRadio').css(["display", "none"]);        if($indexClicked == 0){            $('#exampleModalLongTitle').text("Detail Fournisseurs inscrits");            tab.forEach(function(val){                $('.modal-body').append("<span class='glyphicon glyphicon-hand-right'></span>&nbsp"+val[0]+" <span class='glyphicon glyphicon-menu-right'></span> Commerciaux : <br>");                val[1].forEach(function(sp){                    $('.modal-body').append("&nbsp&nbsp&nbsp&nbsp&nbsp-&nbsp"+sp+" <br>");                });            });                    }else{            $('#exampleModalLongTitle').text("Detail Fournisseurs non inscrits");            if(tab2 != null){                $.each( tab2, function( key, value ) {                  $('.modal-body').append("<span class='glyphicon glyphicon-hand-right'></span>&nbsp"+value+"<br>");                });            }else{                $('.modal-body').append("AUCUN");            }                    }    });// END Pie Chart Providers// START bar chart    var NewBarChart = new Chart(document.getElementById("bar-chart"), {        type: 'bar',        data: {          labels: [<?php echo $stringLabels; ?>],          datasets: [            {              label: "Nombre d'heures ",              backgroundColor: [<?php echo $stringcolors; ?>],              data: [<?php echo $stringData; ?>]            }          ]        },        options: {          legend: { display: false },          title: {            display: true,            text: ''          }        }    });    $('input[type=radio][name=customRadioInline1][value=F]').attr('checked', 'true');    $indexClicked = "";    $repere = 0;    $('#customRadioInline1').change(function(){ //bt radio magasin        var phpDetailRdvsForOneDayStore = <?php echo json_encode($DetailRdvsForOneDayStore); ?>;        $clickDetailsStore = phpDetailRdvsForOneDayStore[$indexClicked];        $JQstringLabelsBisStore = [];        $JQstringDataBisStore = [];        $JQstringColorsBisStore = [];        $.each( $clickDetailsStore, function( keyy, value ) {            $JQstringLabelsBisStore[keyy] = value[0];            $JQstringDataBisStore[keyy] = value[1];            $JQstringColorsBisStore[keyy] = $JQstringColors[keyy*5];        });        $('.modal-chart').empty();        $('.modal-chart').append("<canvas id='doughnut1'></canvas>");        var doughnut = document.getElementById("doughnut1");        var ctx = doughnut.getContext('2d');        var myPieChart1 = new Chart(ctx, {            type: 'doughnut',            data: {labels: $JQstringLabelsBisStore,              datasets: [{                 data: $JQstringDataBisStore,                 backgroundColor: $JQstringColorsBisStore,                 hoverBackgroundColor: $JQstringColorsBisStore              }]},            options: {                legend: {                 display: true,                 position: "right"              }            }        });    });    $('#customRadioInline2').change(function(){ //bt radio fournisseur        var phpDetailRdvsForOneDay = <?php echo json_encode($DetailRdvsForOneDay); ?>;        $clickDetails = phpDetailRdvsForOneDay[$indexClicked];        $JQstringLabelsBis = [];        $JQstringDataBis = [];        $JQstringColorsBis = [];        $.each( $clickDetails, function( key, value ) {            $JQstringLabelsBis[key] = value[0];            $JQstringDataBis[key] = value[1];            $JQstringColorsBis[key] = $JQstringColors[key*5];        });        $('.modal-chart').empty();        $('.modal-chart').append("<canvas id='doughnut1'></canvas>");        var doughnut = document.getElementById("doughnut1");        var ctx = doughnut.getContext('2d');        var myPieChart1 = new Chart(ctx, {            type: 'doughnut',            data: {labels: $JQstringLabelsBis,              datasets: [{                 data: $JQstringDataBis,                 backgroundColor: $JQstringColorsBis,                 hoverBackgroundColor: $JQstringColorsBis              }]},            options: {                legend: {                 display: true,                 position: "right"              }            }        });    });    $('#bar-chart').bind('click', function(ev) {        $repere = 1;        var activePoints = NewBarChart.getElementsAtEvent(ev);        $indexClicked = activePoints[0]["_index"];        $("#exampleModalLong").modal('show');        $('.modal-body').empty();        $('#divBtsRadio').show();        $('#divBtsRadio').css(["display", "block"]);        $('.modal-chart').show();        $('.modal-chart').css(["display", "block"]);        $('.modal-chart').empty();        var phpArrayLabelBis = <?php echo json_encode($labelsBis); ?>;        //var phpArrayLabel = <?php echo json_encode($labels); ?>;        //var phpArrayData = <?php echo json_encode($data); ?>;        $clickLabel = phpArrayLabelBis[$indexClicked];        //$clickData = phpArrayData[$indexClicked];        $('#exampleModalLongTitle').text("Répartition des heures de RDV du "+$clickLabel);        $('.modal-chart').append("<canvas id='doughnut1'></canvas>");        if($('#customRadioInline2').is(':checked')){ //fournisseur                        var phpDetailRdvsForOneDay = <?php echo json_encode($DetailRdvsForOneDay); ?>;                        $clickDetails = phpDetailRdvsForOneDay[$indexClicked];                        $JQstringLabelsBis = [];            $JQstringDataBis = [];            $JQstringColorsBis = [];            //console.log(phpDetailRdvsForOneDay);            $.each( $clickDetails, function( key, value ) {                $JQstringLabelsBis[key] = value[0];                $JQstringDataBis[key] = value[1];                $JQstringColorsBis[key] = $JQstringColors[key*5];            });                        var doughnut = document.getElementById("doughnut1");            var ctx = doughnut.getContext('2d');            var myPieChart1 = new Chart(ctx, {                type: 'doughnut',                data: {labels: $JQstringLabelsBis,                  datasets: [{                     data: $JQstringDataBis,                     backgroundColor: $JQstringColorsBis,                     hoverBackgroundColor: $JQstringColorsBis                  }]},                options: {                    legend: {                     display: true,                     position: "right"                  }                }            });        }else if($('#customRadioInline1').is(':checked')){ //magasin            var phpDetailRdvsForOneDayStore = <?php echo json_encode($DetailRdvsForOneDayStore); ?>;            $clickDetailsStore = phpDetailRdvsForOneDayStore[$indexClicked];            $JQstringLabelsBisStore = [];            $JQstringDataBisStore = [];            $.each( $clickDetailsStore, function( key, value ) {                $JQstringLabelsBisStore[key] = value[0];                $JQstringDataBisStore[key] = value[1];            });            var doughnut = document.getElementById("doughnut1");            var ctx = doughnut.getContext('2d');            var myPieChart1 = new Chart(ctx, {                type: 'doughnut',                data: {labels: $JQstringLabelsBisStore,                  datasets: [{                     data: $JQstringDataBisStore,                     backgroundColor: ['<?php echo $colorsPie[20]; ?>', '<?php echo $colorsPie[70]; ?>'],                     hoverBackgroundColor: ['<?php echo $colorsPie[20]; ?>', '<?php echo $colorsPie[70]; ?>']                  }]},                options: {                    legend: {                     display: true,                     position: "right"                  }                }            });        }    });// END bar chart    </script></body></html>