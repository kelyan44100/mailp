<?phprequire_once dirname ( __FILE__ ) . '/view/errors.inc.php';require_once dirname ( __FILE__ ) . '/services/AppServiceImpl.class.php';if(!isset($_SESSION)) session_start(); // Start session// Authentication from bootbox OK ?//if( (!isset($_SESSION['isAuthenticationProviderOK']) && empty($_SESSION['isAuthenticationProviderOK']) ) || //    (isset($_SESSION['isAuthenticationProviderOK']) && empty($_SESSION['isAuthenticationProviderOK']) ) //   ) { header('Location: ./disconnection.php'); } // Redirection to Purchasing Fair listif( ( isset($_SESSION['enterpriseConcerned']) && !empty($_SESSION['enterpriseConcerned']) ) ) {     header('Location: ./purchasing_fair_list.php'); // Redirection to Purchasing Fair list}header( 'content-type: text/html; charset=utf-8' ); // Specifies to the server to return UTF-8$appService = AppServiceImpl::getInstance();?><!DOCTYPE html><html lang="fr"><head>    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="theme-color" content="#0b70b5"><!-- Mobile browser Tab Color -->    <title>PFManagement | Accueil</title>        <!-- Favicon -->    <?php require_once dirname ( __FILE__ ) . '/view/favicon.inc.php'; ?>    <!-- Bootstrap -->    <link href="css/bootstrap.min.css" rel="stylesheet">        <!-- Font Awesome -->    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">        <!-- Select2 -->    <link href="css/plugins/select2/select2.min.css" rel="stylesheet">        <!-- Hover -->    <link href="css/plugins/hover.css/hover-min.css" rel="stylesheet">        <!-- Toastr style -->    <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">    <!-- Animate -->    <link href="css/animate.css" rel="stylesheet">        <!-- Global -->    <link href="css/style.css" rel="stylesheet">        <!-- Custom style -->    <style>    /* https://www.alsacreations.com/astuce/lire/1216-arriere-plan-background-extensible.html | Free images HQ => https://unsplash.com/ | Pattern generator online : http://bgpatterns.com/     * Src : https://unsplash.com/photos/KB8-ueVa0s8     * How to Optimize the background image (Custom Tuto)     * Open the image with Photoshop     * Resize the image with a width of 1920px (with constant L / H ratio)     * 2017 CC Photoshop tab: File -> Export -> Save for Web with 80 quality     */    body { background:url('./img/providers_background.jpg') no-repeat center fixed;-webkit-background-size: cover;/* Pour anciens Chrome et Safari */background-size:cover; }    /* Logo E.Leclerc w/ SCA Ouest ; Font Eurostile used info = http://logonews.fr/2012/10/02/les-nouveautes-de-leclerc/     * Width : (756 / 2) = 378px and height : (92 / 2) = 46px /!\ Adapt values with browser inspector     * Note that .img-responsive is not compatible with text-center, use margin:0 auto instead      */    #applogo { width:340px;height:41px; }	#gdprLogo { width:32px;height:32px; }	#gdprLogo:hover { cursor:pointer; }    /* Replace the icon of the button */    .hvr-icon-forward:before { content: "\f061"; }    /* Form in the center of the page */    #centralForm { width:400px;background-color:#ffffff;padding:20px 20px 20px 20px;border-top:2px solid #0b70b5;box-shadow: 1px 1px 12px #555; }    /* Button to access the list of purchasing fairs */    #submitButtonStore { background-color:#0b70b5;color:#ffffff; }    #submitButtonStore:hover { border:1px solid #ed8b18; }    #adminButton, #providerButton { color:#ed8b18;cursor:pointer; }    /* Admin icon on top-right div */    #adminButton { color:#ed8b18; }    /* Button for register a new Provider */    #addNewProviderButton { background-color:#ffffff;color:#0b70b5;border:1px solid #0b70b5; }    /* Hack to center centralForm */    #divForCenterXsSm { height:70px; }    #divForCenterMdLg { height:100px; }    /* Devices icons in the bottom */    #devicesIcons { cursor:help; }    /* Color orange E.Leclerc */    .colorOrangeLeclerc { color:#ed8b18; }   /* Hack bootbox style */    input:focus { border:1px solid #ed8b18!important; }    .btn-primary { background-color:#ed8b18!important;color:#ffffff!important;border:1px solid #e7eaec!important; }    .btn-primary:hover, .btn-primary:active { background-color:#ed8b18!important;color:#ffffff!important;border:1px solid #000000!important; }    </style></head><body>        <div class="row">        <div id="divForCenterXsSm" class="col-xs-12 col-sm-12 hidden-md hidden-lg">&nbsp;</div> <!-- This div is only showed with xs & sm screens -->        <div id="divForCenterMdLg" class="hidden-xs hidden-sm col-md-12 col-lg-12">&nbsp;</div> <!-- This div is only showed with md & lg screens -->    </div>        <div class="row">        <div class="col-lg-12 text-center">            <div id="centralForm" class="middle-box text-center loginscreen animated fadeInDown">                <div class="text-right m-r-sm">                    <i id="providerButton" class="fa fa-id-card-o hvr-bounce-in" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Fournisseur" onclick="$(location).attr('href', './index_store.php');"></i>                    <span class="colorOrangeLeclerc">&nbsp;-&nbsp;</span>                    <i id="adminButton" class="fa fa-lock hvr-bounce-in" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Administration" onclick="askUserAdminPassword()"></i>                </div>                                <!-- To center images which use the .img-responsive class, use .center-block instead of .text-center. (doc Bootstrap) -->                <img id="applogo" class="img-responsive m-b-xl center-block" src="./img/logo_eleclerc_scaouest.png" alt="PFManagement">                 <h3 class="colorOrangeLeclerc m-t-xl">Bienvenue sur la plateforme d'inscription aux RDV GT</h3>                <h3 class="colorOrangeLeclerc"><i class="fa fa-handshake-o" aria-hidden="true"></i></h3>                <p class="text-center m-b-xl">Pour commencer, Entrez votre mail et validez.</p>                <form id="indexForm" class="m-t" role="form" action="./purchasing_fair_list.php" method="POST">                    <input id="mailEnterprise" name="mailEnterprise" placeholder="Entrez votre mail"                           class="form-group form-control"><!--                    <select id="selectEnterprise" name="selectEnterprise" class="form-group form-control">--><!----><!--                        <option value="">--- Choix Commission ---</option>--><!----><!--                        --><?php //////                        $arrayEnterprises = $appService->findAllEnterprisesAsProviders();////                        foreach($arrayEnterprises as $key => $value) {////                            echo '<option value="'.$value->getIdEnterprise().'">'.$value->getName().' ('.$value->getOneTypeOfProvider()->getNameTypeOfProvider()[0].')</option>';////                        }////                        ?><!----><!--                    </select>-->                    <button type="submit" id="submitButtonStore" name="submitButtonStore" class="btn block full-width m-t hvr-icon-forward">Liste des RDV GT</button>                    <!-- <button type="button" id="addNewProviderButton" name="addNewProviderButton" class="btn btn-info block full-width m-t-xs m-b hvr-icon-float-away" onclick="askUserToWriteNewProviderName();">Pas dans la liste ?</button>-->                </form>                <p class="m-t-md"> <small><i class="fa fa-copyright" aria-hidden="true"></i> E.Leclerc | SCA Ouest <?php echo date('Y'); ?></small> </p>				<div>				<!-- To center images which use the .img-responsive class, use .center-block instead of .text-center. (doc Bootstrap) -->                <img id="gdprLogo" class="img-responsive center-block" src="./img/flags/64/European-Union.png" alt="GRPD" data-toggle="modal" data-target="#myModal">				</div>				<div id="devicesIcons" class="text-center m-t-sm">                    <i class="fa fa-mobile fa-2x" data-toggle="tooltip" data-placement="top" title="Smartphone"></i>&nbsp;&nbsp;&nbsp;                    <i class="fa fa-tablet fa-2x" data-toggle="tooltip" data-placement="top" title="Tablette"></i>&nbsp;&nbsp;&nbsp;                    <i class="fa fa-laptop fa-2x" data-toggle="tooltip" data-placement="top" title="Portable"></i>&nbsp;&nbsp;&nbsp;                    <i class="fa fa-desktop fa-2x" data-toggle="tooltip" data-placement="top" title="Bureau"></i>&nbsp;&nbsp;&nbsp;                    <i class="fa fa-television fa-2x" data-toggle="tooltip" data-placement="top" title="TV"></i>                </div>            </div>                    </div>    </div>        <div class="row">        <div id="divForCenterXsSm" class="col-xs-12 col-sm-12 hidden-md hidden-lg">&nbsp;</div> <!-- This div is only showed with xs & sm screens -->        <div id="divForCenterMdLg" class="hidden-xs hidden-sm col-md-12 col-lg-12">&nbsp;</div> <!-- This div is only showed with md & lg screens -->    </div>    <!-- Mainly scripts -->    <script src="js/jquery-3.1.1.min.js"></script>    <script src="js/bootstrap.min.js"></script>        <!-- Toastr script -->    <script src="js/plugins/toastr/toastr.min.js"></script>        <!-- Select2 -->    <script src="js/plugins/select2/select2.full.min.js"></script>    <script src="js/plugins/select2/i18n/fr.js"></script>        <!-- Bootbox -->    <script src="js/plugins/bootbox.js/bootbox.min.js"></script>        <!-- Custom script -->    <script>    // Activate the display of information when hover the icons    $(function () { $('[data-toggle="tooltip"]').tooltip(); });        // Toastr options - Added 02.08.2018    toastr.options = {      "closeButton": true,      "debug": false,      "newestOnTop": false,      "progressBar": true,      "positionClass": "toast-top-right",      "preventDuplicates": true,      "onclick": null,      "showDuration": "300",      "hideDuration": "1000",      "timeOut": "3500",      "extendedTimeOut": "1000",      "showEasing": "swing",      "hideEasing": "linear",      "showMethod": "fadeIn",      "hideMethod": "fadeOut"    };        // Added 30.08.2018    // https://developer.tizen.org/community/tip-tech/html5-local-storage    if( typeof localStorage !== 'undefined' ) { // Check if localStorage is supported by user browser                if( 'loginAttempts' in localStorage) { // At leat one attempt            var loginAttempts = parseInt(localStorage.getItem('loginAttempts', loginAttempts), 10);        }        else { // Default 0            var loginAttempts = 0;            localStorage.setItem('loginAttempts', loginAttempts);        }                if( 'lastLoginAttempt' in localStorage) { // At leat one attempt w/ error            var lastLoginAttempt = localStorage.getItem('lastLoginAttempt');            var lastLoginAttemptSplitted = lastLoginAttempt.split(',');                        // Get now date and time            var now = new Date().getTime();                        // Set the last login attempt date            var lastLoginAttemptFormattted = new Date(                parseInt(lastLoginAttemptSplitted[0],10),                parseInt(lastLoginAttemptSplitted[1],10),                parseInt(lastLoginAttemptSplitted[2],10),                parseInt(lastLoginAttemptSplitted[3],10),                parseInt(lastLoginAttemptSplitted[4],10),                parseInt(lastLoginAttemptSplitted[5],10));                            var distance = now - lastLoginAttemptFormattted.getTime();            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));            if(minutes > 30) { // if > 0.5 hour                localStorage.setItem('loginAttempts', 0);                localStorage.removeItem('lastLoginAttempt');            }        }        if( 'bannedIp' in localStorage && 'banDate' in localStorage) { // If an existing saving DataTable exists            var bannedIp = localStorage.getItem('bannedIp');            var banDate  = localStorage.getItem('banDate');            var banDateSplitted = banDate.split(',');            // Get now date and time            var now = new Date().getTime();            // Set the bad date            var banDateFormattted = new Date(                parseInt(banDateSplitted[0],10),                parseInt(banDateSplitted[1],10),                parseInt(banDateSplitted[2],10),                parseInt(banDateSplitted[3],10),                parseInt(banDateSplitted[4],10),                parseInt(banDateSplitted[5],10));                var distance = now - banDateFormattted.getTime();                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));                var seconds = Math.floor((distance % (1000 * 60)) / 1000);            if(bannedIp === '<?php echo $appService->getIpAddress(); ?>' && minutes < 3) {                toastr.error('Vous êtes banni temporairement depuis ' + minutes + 'm' + seconds + 's. Au bout de 3 minutes, rafraîchissez la page pour pouvoir vous reconnecter.', 'Accès impossible.');                $('#submitButtonStore').prop('disabled', true);            }            else {                localStorage.removeItem('bannedIp');                localStorage.removeItem('banDate');                localStorage.removeItem('lastLoginAttempt');                var loginAttempts = 0;                localStorage.setItem('loginAttempts', 0);            }        }        else { /*console.log('Pas d\'items bannedIp & banDate définis dans localStorage');*/ }    } else { console.log("localStorage is not supported !"); }        $("#indexForm").submit(function(e) {         e.preventDefault(); // To stop the form from submitting        var maRegex = /^[^\W][a-zA-Z0-9_]+(\.[a-zA-Z0-9_]+)*\@[a-zA-Z0-9_]+(\.[a-zA-Z0-9_]+)*\.[a-zA-Z]{2,4}$/;        var mailEnterprise = $("#mailEnterprise").val();        console.log(mailEnterprise);        //Si ma regex est valide je rentre dans le if       if (maRegex.test(mailEnterprise)) {                        var icon = '<i class="fa fa-key" aria-hidden="true"></i>';                    bootbox.prompt({                title: 'Authentification requise<br>' + icon + ' <em>Veuillez saisir le mot de passe pour l\'accès commission</em>',                inputType: 'password',                callback: function (result) {                        if(result !== '' && result !== null) {                        $.post(                            './ajax/authentication.php',                            {                                mailEnterprise : $("#mailEnterprise").val(),                                passwordEnterprise : result,                                profileEnterprise : 'provider'                            },                            function(data) {                                if(data.trim() === 'Success') {                                    console.log("je suis dans le if")                                    if( typeof localStorage !== 'undefined' ) { // Check if localStorage is supported by user browser                                        localStorage.removeItem('loginAttempts');                                        localStorage.removeItem('lastLoginAttempt');                                    } else { console.log("localStorage is not supported !"); }	                                                toastr.success('Authentification réussie.', 'Succès.');                                    window.location.href = './purchasing_fair_list.php'; // If all the validations OK                                                                    }                                else {                                    console.log("je suis dans le else")                                    // ++loginAttempts;                                    localStorage.setItem('loginAttempts', loginAttempts);                                    if(loginAttempts < 3) {                                        toastr.error('Erreur d\'authentification. Il vous reste ' + (3 - loginAttempts) + ' tentatives avant d\'être banni temporairement.', 'Échec.');                                                                                    var lastLoginAttempt = new Date();                                                        localStorage.setItem( 'lastLoginAttempt',                                                 lastLoginAttempt.getFullYear() + ',' +                                                 lastLoginAttempt.getMonth() + ',' +                                                 lastLoginAttempt.getDate() + ',' +                                                 lastLoginAttempt.getHours() + ',' +                                                 lastLoginAttempt.getMinutes() + ',' +                                                 lastLoginAttempt.getSeconds() );                                    }                                    else {                                        toastr.error('Trop de connexions échouées, retentez votre chance dans trois minutes (rafraîchissez la page).', 'Avertissement');                                        $('#submitButtonStore').prop('disabled', true);                                        if( typeof localStorage !== 'undefined' ) { // Check if localStorage is supported by user browser		                                            localStorage.setItem( 'bannedIp', '<?php echo $appService->getIpAddress(); ?>' );                                            var banDate = new Date();                                            localStorage.setItem( 'banDate',                                                 banDate.getFullYear() + ',' +                                                 banDate.getMonth() + ',' +                                                 banDate.getDate() + ',' +                                                 banDate.getHours() + ',' +                                                 banDate.getMinutes() + ',' +                                                 banDate.getSeconds() );                                                                                    } else { console.log("localStorage is not supported !"); }	                                    }                                }                            },                            'text'                        );                    }                }            });        }        else {            toastr.error('Merci d\'entrer votre mail.', 'Erreur.');        }    });        // Bootbox prompt        bootbox.setDefaults({ locale: "fr" });    function askUserToWriteNewProviderName() {        var icon = '<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>';        bootbox.prompt('Nom de la nouvelle commission ?<br>' + icon + ' <em>Attention, sa création est immédiate si validée.</em>', function(result) {                        if(result !== null) {                            // Note: The trim() & toUpperCase() methods do not change the original string.prototype                result = result.trim().toUpperCase();                $.post(                    './ajax/insertNewProvider.php',                    {                        nameNewProvider : result.trim().toUpperCase()                    },                    function(data) {                        data = data.trim();                        if(data != 0) {                             // $('#selectEnterprise').select2('destroy');                            // $('#selectEnterprise').remove();                            var dataOption = { id: data, text: '* ' + result };                            // Create a DOM Option and pre-select by default                            // The third parameter of new Option(...) determines whether the item is "default selected"; i.e. it sets the selected attribute for the new option.                             // The fourth parameter sets the options actual selected state - if set to true, the new option will be selected by default.                            var newOption = new Option(dataOption.text, dataOption.id, true, true);                            // Append it to the select                            $('#selectEnterprise').append(newOption).trigger('change');                        }                        else {                            toastr.error('Impossible d\'ajouter cette commission car le nom existe déjà !', 'Échec.');                        }                    },                    'text'                );            }        });     }    bootbox.setDefaults({ locale: "fr" });        function askUserAdminPassword() {                var icon = '<i class="fa fa-key" aria-hidden="true"></i>';                bootbox.prompt({            title: 'Authentification requise<br>' + icon + ' <em>Veuillez saisir le mot de passe pour l\'accès Administrateur</em>',            inputType: 'password',            callback: function (result) {                                                    if(result !== '' && result !== null) {                                $.post(                        './ajax/authenticationAdmin.php',                        {                            password : result                        },                        function(data) {                            if(data.trim() === 'Success') {                                 toastr.success('Authentification réussie..', 'Succès.');                                window.location.href = './purchasing_fair_list.php'; // If all the validations OK                            }                            else {                                toastr.error('Erreur d\'authentification.', 'Échec.');                            }                        },                        'text'                    );                }            }        });    }    </script>		<!-- Modal -->	<!--     ---- Bug Internet Explorer 30/01/2018 : Bootstrap modal appearing under background    ---- Easiest way is to just move the modal div so it is outside any elements with special positioning.     ---- One good place might be just before the closing body tag </body>.    ---- Src : https://stackoverflow.com/questions/10636667/bootstrap-modal-appearing-under-background    -->	<div class="modal inmodal" id="myModal" tabindex="-1" role="dialog" aria-hidden="true">		<div class="modal-dialog modal-lg">		<div class="modal-content animated fadeInDown">				<div class="modal-header">					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>					<i class="fa fa-gavel modal-icon"></i>					<h4 class="modal-title">RGPD</h4>					<small class="font-bold">Règlement Général sur la Protection des Données Union Européenne 2016/679</small>				</div>				<div class="modal-body">					<p class="text-center">					<!-- 					---- http://www.technologia.fr/blog/rgpd-modeles-de-messages-dinformation-a-utiliser/ 					---- https://www.net-helium.fr/blog/rgpd-quelle-duree-de-conservation-des-donnees/23					-->					- Les informations recueillies vous concernant font l’objet d’un traitement destiné à :					<br/>RESPONSABLE DU TRAITEMENT / DÉLÉGUÉ À LA PROTECTION DES DONNÉES PERSONNELLES					<br/>1 ROUTE DE CORDEMAIS					<br/>44360 SAINT-ÉTIENNE-DE-MONTLUC					<br/>- Pour la finalité suivante : <u>Organiser les salons d'achats</u>					<br/>- Les destinataires de ces données sont :					<br/>SERVICES SCA OUEST / BÂTIMENT ADMINISTRATIF					<br/>1 ROUTE DE CORDEMAIS					<br/>44360 SAINT-ÉTIENNE-DE-MONTLUC					<br/>- La durée de conservation des données est de <strong>36 mois (3 ans)</strong>.					<br/>- Vous bénéficiez d’un droit d’accès, de rectification, de portabilité, d’effacement de celles-ci ou une limitation du traitement.					<br/>- Vous pouvez vous opposer au traitement des données vous concernant et disposez du droit de retirer votre consentement à tout moment en vous adressant à :					<br/>RESPONSABLE DU TRAITEMENT / DÉLÉGUÉ À LA PROTECTION DES DONNÉES PERSONNELLES					<br/>1 ROUTE DE CORDEMAIS					<br/>44360 SAINT-ÉTIENNE-DE-MONTLUC					<br/>- Vous avez la possibilité d’introduire une réclamation auprès d’une autorité de contrôle.					</p>				</div>				<div class="modal-footer">					<button type="button" class="btn btn-outline btn-danger" data-dismiss="modal">Fermer</button>				</div>			</div>		</div>	</div></body></html>